import Data
from numpy import inf
from collections import OrderedDict
from FuncDesigner import oovars

if Data.model_init == False:
    Data.constrained = True
    Data.local_constrained = False
    Data.snle = False
    Data.param = OrderedDict()
    Data.param = {
              'r1' :  0.166882378701,
              'r2'  : 0.106756435296,
              #'k2' : 0.0,
              'k1A'  : 0.0767597197741,
              'kratio' : 1.0,
              'kfactor'  : 1.0,
              }
    """
    Data.param = {
              'r1' :  0.4,
              'r2'  : 0.4,
              #'k2' : 0.0,
              'k1A'  : 1.0,
              'kratio' : 1.0,
              'kfactor'  : 1.0,
              }
    """
    Data.param_upper_bounds = OrderedDict()
    Data.param_upper_bounds = {
              'r1' : 0.4,
              'r2'  : 0.4,
              'k1A'  : 100.0,
              'kratio' : 500.0,
              'kfactor'  : 10.0,
              }
    Data.param_lower_bounds = OrderedDict()
    Data.param_lower_bounds = {
              'r1' : -0.2,
              'r2'  : -0.2,
              'k1A'  : 0.001,
              'kratio' : 0.1,
              'kfactor'  : 0.5,
              }

    Data.use_individual_params = OrderedDict()
    for key in Data.param:
        Data.use_individual_params[key] = False

    Data.model_init = True


#from openopt import SNLE
#from FuncDesigner import oovar
#from numpy import ones
#from numpy import zeros

"""
from openopt import GLP
from numpy import array
from FuncDesigner import oovar
from FuncDesigner import oosystem
"""

#from numpy import sqrt
from numpy.lib.scimath import sqrt
from numpy import conj


def func(param, return_oofunvalue=False, snle_style = False):
    import time
    start_time = time.time()

    P = -((param['kratio']*(param['k1A']*param['kfactor']+(8.0*param["Substrate"]*param['k1A']**2.0)/param['kratio']-(4.0*param['k1A']**2.0*param["x"])/param['kratio']))/(12.0*param['k1A']**2.0))-(param['kratio']*((12.0*param['k1A']**2.0*(1.0+param["Substrate"]*param['k1A']*param['kfactor']-param['k1A']*param['kfactor']*param["x"]))/param['kratio']-(param['k1A']*param['kfactor']+(8.0*param["Substrate"]*param['k1A']**2.0)/param['kratio']-(4.0*param['k1A']**2.0*param["x"])/param['kratio'])**2.0))/(6.0*2.0**(2.0/3.0)*param['k1A']**2.0*(-2.0*param['k1A']**3.0*param['kfactor']**3.0-(1024.0*param["Substrate"]**3.0*param['k1A']**6.0)/param['kratio']**3.0+(288.0*param["Substrate"]*param['k1A']**4.0)/param['kratio']**2.0-(96.0*param["Substrate"]**2.0*param['k1A']**5.0*param['kfactor'])/param['kratio']**2.0+(36.0*param['k1A']**3.0*param['kfactor'])/param['kratio']-(12.0*param["Substrate"]*param['k1A']**4.0*param['kfactor']**2.0)/param['kratio']+(1536.0*param["Substrate"]**2.0*param['k1A']**6.0*param["x"])/param['kratio']**3.0+(288.0*param['k1A']**4.0*param["x"])/param['kratio']**2.0-(48.0*param["Substrate"]*param['k1A']**5.0*param['kfactor']*param["x"])/param['kratio']**2.0-(12.0*param['k1A']**4.0*param['kfactor']**2.0*param["x"])/param['kratio']-(768.0*param["Substrate"]*param['k1A']**6.0*param["x"]**2.0)/param['kratio']**3.0+(48.0*param['k1A']**5.0*param['kfactor']*param["x"]**2.0)/param['kratio']**2.0+(128.0*param['k1A']**6.0*param["x"]**3.0)/param['kratio']**3.0+sqrt((-2.0*param['k1A']**3.0*param['kfactor']**3.0-(1024.0*param["Substrate"]**3.0*param['k1A']**6.0)/param['kratio']**3.0+(288.0*param["Substrate"]*param['k1A']**4.0)/param['kratio']**2.0-(96.0*param["Substrate"]**2.0*param['k1A']**5.0*param['kfactor'])/param['kratio']**2.0+(36.0*param['k1A']**3.0*param['kfactor'])/param['kratio']-(12.0*param["Substrate"]*param['k1A']**4.0*param['kfactor']**2.0)/param['kratio']+(1536.0*param["Substrate"]**2.0*param['k1A']**6.0*param["x"])/param['kratio']**3.0+(288.0*param['k1A']**4.0*param["x"])/param['kratio']**2.0-(48.0*param["Substrate"]*param['k1A']**5.0*param['kfactor']*param["x"])/param['kratio']**2.0-(12.0*param['k1A']**4.0*param['kfactor']**2.0*param["x"])/param['kratio']-(768.0*param["Substrate"]*param['k1A']**6.0*param["x"]**2.0)/param['kratio']**3.0+(48.0*param['k1A']**5.0*param['kfactor']*param["x"]**2.0)/param['kratio']**2.0+(128.0*param['k1A']**6.0*param["x"]**3.0)/param['kratio']**3.0)**2.0+4.0*((12.0*param['k1A']**2.0*(1.0+param["Substrate"]*param['k1A']*param['kfactor']-param['k1A']*param['kfactor']*param["x"]))/param['kratio']-(param['k1A']*param['kfactor']+(8.0*param["Substrate"]*param['k1A']**2.0)/param['kratio']-(4.0*param['k1A']**2.0*param["x"])/param['kratio'])**2.0)**3.0))**(1.0/3.0))+(1.0/(12.0*2.0**(1.0/3.0)*param['k1A']**2.0))*param['kratio']*(-2.0*param['k1A']**3.0*param['kfactor']**3.0-(1024.0*param["Substrate"]**3.0*param['k1A']**6.0)/param['kratio']**3.0+(288.0*param["Substrate"]*param['k1A']**4.0)/param['kratio']**2.0-(96.0*param["Substrate"]**2.0*param['k1A']**5.0*param['kfactor'])/param['kratio']**2.0+(36.0*param['k1A']**3.0*param['kfactor'])/param['kratio']-(12.0*param["Substrate"]*param['k1A']**4.0*param['kfactor']**2.0)/param['kratio']+(1536.0*param["Substrate"]**2.0*param['k1A']**6.0*param["x"])/param['kratio']**3.0+(288.0*param['k1A']**4.0*param["x"])/param['kratio']**2.0-(48.0*param["Substrate"]*param['k1A']**5.0*param['kfactor']*param["x"])/param['kratio']**2.0-(12.0*param['k1A']**4.0*param['kfactor']**2.0*param["x"])/param['kratio']-(768.0*param["Substrate"]*param['k1A']**6.0*param["x"]**2.0)/param['kratio']**3.0+(48.0*param['k1A']**5.0*param['kfactor']*param["x"]**2.0)/param['kratio']**2.0+(128.0*param['k1A']**6.0*param["x"]**3.0)/param['kratio']**3.0+sqrt((-2.0*param['k1A']**3.0*param['kfactor']**3.0-(1024.0*param["Substrate"]**3.0*param['k1A']**6.0)/param['kratio']**3.0+(288.0*param["Substrate"]*param['k1A']**4.0)/param['kratio']**2.0-(96.0*param["Substrate"]**2.0*param['k1A']**5.0*param['kfactor'])/param['kratio']**2.0+(36.0*param['k1A']**3.0*param['kfactor'])/param['kratio']-(12.0*param["Substrate"]*param['k1A']**4.0*param['kfactor']**2.0)/param['kratio']+(1536.0*param["Substrate"]**2.0*param['k1A']**6.0*param["x"])/param['kratio']**3.0+(288.0*param['k1A']**4.0*param["x"])/param['kratio']**2.0-(48.0*param["Substrate"]*param['k1A']**5.0*param['kfactor']*param["x"])/param['kratio']**2.0-(12.0*param['k1A']**4.0*param['kfactor']**2.0*param["x"])/param['kratio']-(768.0*param["Substrate"]*param['k1A']**6.0*param["x"]**2.0)/param['kratio']**3.0+(48.0*param['k1A']**5.0*param['kfactor']*param["x"]**2.0)/param['kratio']**2.0+(128.0*param['k1A']**6.0*param["x"]**3.0)/param['kratio']**3.0)**2.0+4.0*((12.0*param['k1A']**2.0*(1.0+param["Substrate"]*param['k1A']*param['kfactor']-param['k1A']*param['kfactor']*param["x"]))/param['kratio']-(param['k1A']*param['kfactor']+(8.0*param["Substrate"]*param['k1A']**2.0)/param['kratio']-(4.0*param['k1A']**2.0*param["x"])/param['kratio'])**2.0)**3.0))**(1.0/3.0)
    S = 1.0/(-param['k1A']*param['kfactor']**2.0+(16.0*param['k1A'])/param['kratio'])*(-param["Substrate"]*param['k1A']*param['kfactor']**2.0+(16.0*param["Substrate"]*param['k1A'])/param['kratio']+param['k1A']*param['kfactor']**2.0*param["x"]-(8.0*param['k1A']*param["x"])/param['kratio']-param['k1A']*param['kfactor']**2.0*(-((param['kratio']*(param['k1A']*param['kfactor']+(8.0*param["Substrate"]*param['k1A']**2.0)/param['kratio']-(4.0*param['k1A']**2.0*param["x"])/param['kratio']))/(12.0*param['k1A']**2.0))-(param['kratio']*((12.0*param['k1A']**2.0*(1.0+param["Substrate"]*param['k1A']*param['kfactor']-param['k1A']*param['kfactor']*param["x"]))/param['kratio']-(param['k1A']*param['kfactor']+(8.0*param["Substrate"]*param['k1A']**2.0)/param['kratio']-(4.0*param['k1A']**2.0*param["x"])/param['kratio'])**2.0))/(6.0*2.0**(2.0/3.0)*param['k1A']**2.0*(-2.0*param['k1A']**3.0*param['kfactor']**3.0-(1024.0*param["Substrate"]**3.0*param['k1A']**6.0)/param['kratio']**3.0+(288.0*param["Substrate"]*param['k1A']**4.0)/param['kratio']**2.0-(96.0*param["Substrate"]**2.0*param['k1A']**5.0*param['kfactor'])/param['kratio']**2.0+(36.0*param['k1A']**3.0*param['kfactor'])/param['kratio']-(12.0*param["Substrate"]*param['k1A']**4.0*param['kfactor']**2.0)/param['kratio']+(1536.0*param["Substrate"]**2.0*param['k1A']**6.0*param["x"])/param['kratio']**3.0+(288.0*param['k1A']**4.0*param["x"])/param['kratio']**2.0-(48.0*param["Substrate"]*param['k1A']**5.0*param['kfactor']*param["x"])/param['kratio']**2.0-(12.0*param['k1A']**4.0*param['kfactor']**2.0*param["x"])/param['kratio']-(768.0*param["Substrate"]*param['k1A']**6.0*param["x"]**2.0)/param['kratio']**3.0+(48.0*param['k1A']**5.0*param['kfactor']*param["x"]**2.0)/param['kratio']**2.0+(128.0*param['k1A']**6.0*param["x"]**3.0)/param['kratio']**3.0+sqrt((-2.0*param['k1A']**3.0*param['kfactor']**3.0-(1024.0*param["Substrate"]**3.0*param['k1A']**6.0)/param['kratio']**3.0+(288.0*param["Substrate"]*param['k1A']**4.0)/param['kratio']**2.0-(96.0*param["Substrate"]**2.0*param['k1A']**5.0*param['kfactor'])/param['kratio']**2.0+(36.0*param['k1A']**3.0*param['kfactor'])/param['kratio']-(12.0*param["Substrate"]*param['k1A']**4.0*param['kfactor']**2.0)/param['kratio']+(1536.0*param["Substrate"]**2.0*param['k1A']**6.0*param["x"])/param['kratio']**3.0+(288.0*param['k1A']**4.0*param["x"])/param['kratio']**2.0-(48.0*param["Substrate"]*param['k1A']**5.0*param['kfactor']*param["x"])/param['kratio']**2.0-(12.0*param['k1A']**4.0*param['kfactor']**2.0*param["x"])/param['kratio']-(768.0*param["Substrate"]*param['k1A']**6.0*param["x"]**2.0)/param['kratio']**3.0+(48.0*param['k1A']**5.0*param['kfactor']*param["x"]**2.0)/param['kratio']**2.0+(128.0*param['k1A']**6.0*param["x"]**3.0)/param['kratio']**3.0)**2.0+4.0*((12.0*param['k1A']**2.0*(1.0+param["Substrate"]*param['k1A']*param['kfactor']-param['k1A']*param['kfactor']*param["x"]))/param['kratio']-(param['k1A']*param['kfactor']+(8.0*param["Substrate"]*param['k1A']**2.0)/param['kratio']-(4.0*param['k1A']**2.0*param["x"])/param['kratio'])**2.0)**3.0))**(1.0/3.0))+1.0/(12.0*2.0**(1.0/3.0)*param['k1A']**2.0)*param['kratio']*(-2.0*param['k1A']**3.0*param['kfactor']**3.0-(1024.0*param["Substrate"]**3.0*param['k1A']**6.0)/param['kratio']**3.0+(288.0*param["Substrate"]*param['k1A']**4.0)/param['kratio']**2.0-(96.0*param["Substrate"]**2.0*param['k1A']**5.0*param['kfactor'])/param['kratio']**2.0+(36.0*param['k1A']**3.0*param['kfactor'])/param['kratio']-(12.0*param["Substrate"]*param['k1A']**4.0*param['kfactor']**2.0)/param['kratio']+(1536.0*param["Substrate"]**2.0*param['k1A']**6.0*param["x"])/param['kratio']**3.0+(288.0*param['k1A']**4.0*param["x"])/param['kratio']**2.0-(48.0*param["Substrate"]*param['k1A']**5.0*param['kfactor']*param["x"])/param['kratio']**2.0-(12.0*param['k1A']**4.0*param['kfactor']**2.0*param["x"])/param['kratio']-(768.0*param["Substrate"]*param['k1A']**6.0*param["x"]**2.0)/param['kratio']**3.0+(48.0*param['k1A']**5.0*param['kfactor']*param["x"]**2.0)/param['kratio']**2.0+(128.0*param['k1A']**6.0*param["x"]**3.0)/param['kratio']**3.0+sqrt((-2.0*param['k1A']**3.0*param['kfactor']**3.0-(1024.0*param["Substrate"]**3.0*param['k1A']**6.0)/param['kratio']**3.0+(288.0*param["Substrate"]*param['k1A']**4.0)/param['kratio']**2.0-(96.0*param["Substrate"]**2.0*param['k1A']**5.0*param['kfactor'])/param['kratio']**2.0+(36.0*param['k1A']**3.0*param['kfactor'])/param['kratio']-(12.0*param["Substrate"]*param['k1A']**4.0*param['kfactor']**2.0)/param['kratio']+(1536.0*param["Substrate"]**2.0*param['k1A']**6.0*param["x"])/param['kratio']**3.0+(288.0*param['k1A']**4.0*param["x"])/param['kratio']**2.0-(48.0*param["Substrate"]*param['k1A']**5.0*param['kfactor']*param["x"])/param['kratio']**2.0-(12.0*param['k1A']**4.0*param['kfactor']**2.0*param["x"])/param['kratio']-(768.0*param["Substrate"]*param['k1A']**6.0*param["x"]**2.0)/param['kratio']**3.0+(48.0*param['k1A']**5.0*param['kfactor']*param["x"]**2.0)/param['kratio']**2.0+(128.0*param['k1A']**6.0*param["x"]**3.0)/param['kratio']**3.0)**2.0+4.0*((12.0*param['k1A']**2.0*(1.0+param["Substrate"]*param['k1A']*param['kfactor']-param['k1A']*param['kfactor']*param["x"]))/param['kratio']-(param['k1A']*param['kfactor']+(8.0*param["Substrate"]*param['k1A']**2.0)/param['kratio']-(4.0*param['k1A']**2.0*param["x"])/param['kratio'])**2.0)**3.0))**(1.0/3.0))+1.0/param['kratio']*8.0*param['k1A']*(-((param['kratio']*(param['k1A']*param['kfactor']+(8.0*param["Substrate"]*param['k1A']**2.0)/param['kratio']-(4.0*param['k1A']**2.0*param["x"])/param['kratio']))/(12.0*param['k1A']**2.0))-(param['kratio']*((12.0*param['k1A']**2.0*(1.0+param["Substrate"]*param['k1A']*param['kfactor']-param['k1A']*param['kfactor']*param["x"]))/param['kratio']-(param['k1A']*param['kfactor']+(8.0*param["Substrate"]*param['k1A']**2.0)/param['kratio']-(4.0*param['k1A']**2.0*param["x"])/param['kratio'])**2.0))/(6.0*2.0**(2.0/3.0)*param['k1A']**2.0*(-2.0*param['k1A']**3.0*param['kfactor']**3.0-(1024.0*param["Substrate"]**3.0*param['k1A']**6.0)/param['kratio']**3.0+(288.0*param["Substrate"]*param['k1A']**4.0)/param['kratio']**2.0-(96.0*param["Substrate"]**2.0*param['k1A']**5.0*param['kfactor'])/param['kratio']**2.0+(36.0*param['k1A']**3.0*param['kfactor'])/param['kratio']-(12.0*param["Substrate"]*param['k1A']**4.0*param['kfactor']**2.0)/param['kratio']+(1536.0*param["Substrate"]**2.0*param['k1A']**6.0*param["x"])/param['kratio']**3.0+(288.0*param['k1A']**4.0*param["x"])/param['kratio']**2.0-(48.0*param["Substrate"]*param['k1A']**5.0*param['kfactor']*param["x"])/param['kratio']**2.0-(12.0*param['k1A']**4.0*param['kfactor']**2.0*param["x"])/param['kratio']-(768.0*param["Substrate"]*param['k1A']**6.0*param["x"]**2.0)/param['kratio']**3.0+(48.0*param['k1A']**5.0*param['kfactor']*param["x"]**2.0)/param['kratio']**2.0+(128.0*param['k1A']**6.0*param["x"]**3.0)/param['kratio']**3.0+sqrt((-2.0*param['k1A']**3.0*param['kfactor']**3.0-(1024.0*param["Substrate"]**3.0*param['k1A']**6.0)/param['kratio']**3.0+(288.0*param["Substrate"]*param['k1A']**4.0)/param['kratio']**2.0-(96.0*param["Substrate"]**2.0*param['k1A']**5.0*param['kfactor'])/param['kratio']**2.0+(36.0*param['k1A']**3.0*param['kfactor'])/param['kratio']-(12.0*param["Substrate"]*param['k1A']**4.0*param['kfactor']**2.0)/param['kratio']+(1536.0*param["Substrate"]**2.0*param['k1A']**6.0*param["x"])/param['kratio']**3.0+(288.0*param['k1A']**4.0*param["x"])/param['kratio']**2.0-(48.0*param["Substrate"]*param['k1A']**5.0*param['kfactor']*param["x"])/param['kratio']**2.0-(12.0*param['k1A']**4.0*param['kfactor']**2.0*param["x"])/param['kratio']-(768.0*param["Substrate"]*param['k1A']**6.0*param["x"]**2.0)/param['kratio']**3.0+(48.0*param['k1A']**5.0*param['kfactor']*param["x"]**2.0)/param['kratio']**2.0+(128.0*param['k1A']**6.0*param["x"]**3.0)/param['kratio']**3.0)**2.0+4.0*((12.0*param['k1A']**2.0*(1.0+param["Substrate"]*param['k1A']*param['kfactor']-param['k1A']*param['kfactor']*param["x"]))/param['kratio']-(param['k1A']*param['kfactor']+(8.0*param["Substrate"]*param['k1A']**2.0)/param['kratio']-(4.0*param['k1A']**2.0*param["x"])/param['kratio'])**2.0)**3.0))**(1.0/3.0))+1.0/(12.0*2.0**(1.0/3.0)*param['k1A']**2.0)*param['kratio']*(-2.0*param['k1A']**3.0*param['kfactor']**3.0-(1024.0*param["Substrate"]**3.0*param['k1A']**6.0)/param['kratio']**3.0+(288.0*param["Substrate"]*param['k1A']**4.0)/param['kratio']**2.0-(96.0*param["Substrate"]**2.0*param['k1A']**5.0*param['kfactor'])/param['kratio']**2.0+(36.0*param['k1A']**3.0*param['kfactor'])/param['kratio']-(12.0*param["Substrate"]*param['k1A']**4.0*param['kfactor']**2.0)/param['kratio']+(1536.0*param["Substrate"]**2.0*param['k1A']**6.0*param["x"])/param['kratio']**3.0+(288.0*param['k1A']**4.0*param["x"])/param['kratio']**2.0-(48.0*param["Substrate"]*param['k1A']**5.0*param['kfactor']*param["x"])/param['kratio']**2.0-(12.0*param['k1A']**4.0*param['kfactor']**2.0*param["x"])/param['kratio']-(768.0*param["Substrate"]*param['k1A']**6.0*param["x"]**2.0)/param['kratio']**3.0+(48.0*param['k1A']**5.0*param['kfactor']*param["x"]**2.0)/param['kratio']**2.0+(128.0*param['k1A']**6.0*param["x"]**3.0)/param['kratio']**3.0+sqrt((-2.0*param['k1A']**3.0*param['kfactor']**3.0-(1024.0*param["Substrate"]**3.0*param['k1A']**6.0)/param['kratio']**3.0+(288.0*param["Substrate"]*param['k1A']**4.0)/param['kratio']**2.0-(96.0*param["Substrate"]**2.0*param['k1A']**5.0*param['kfactor'])/param['kratio']**2.0+(36.0*param['k1A']**3.0*param['kfactor'])/param['kratio']-(12.0*param["Substrate"]*param['k1A']**4.0*param['kfactor']**2.0)/param['kratio']+(1536.0*param["Substrate"]**2.0*param['k1A']**6.0*param["x"])/param['kratio']**3.0+(288.0*param['k1A']**4.0*param["x"])/param['kratio']**2.0-(48.0*param["Substrate"]*param['k1A']**5.0*param['kfactor']*param["x"])/param['kratio']**2.0-(12.0*param['k1A']**4.0*param['kfactor']**2.0*param["x"])/param['kratio']-(768.0*param["Substrate"]*param['k1A']**6.0*param["x"]**2.0)/param['kratio']**3.0+(48.0*param['k1A']**5.0*param['kfactor']*param["x"]**2.0)/param['kratio']**2.0+(128.0*param['k1A']**6.0*param["x"]**3.0)/param['kratio']**3.0)**2.0+4.0*((12.0*param['k1A']**2.0*(1.0+param["Substrate"]*param['k1A']*param['kfactor']-param['k1A']*param['kfactor']*param["x"]))/param['kratio']-(param['k1A']*param['kfactor']+(8.0*param["Substrate"]*param['k1A']**2.0)/param['kratio']-(4.0*param['k1A']**2.0*param["x"])/param['kratio'])**2.0)**3.0))**(1.0/3.0))-1.0/param['kratio']*8.0*param["Substrate"]*param['k1A']**2.0*param['kfactor']*(-((param['kratio']*(param['k1A']*param['kfactor']+(8.0*param["Substrate"]*param['k1A']**2.0)/param['kratio']-(4.0*param['k1A']**2.0*param["x"])/param['kratio']))/(12.0*param['k1A']**2.0))-(param['kratio']*((12.0*param['k1A']**2.0*(1.0+param["Substrate"]*param['k1A']*param['kfactor']-param['k1A']*param['kfactor']*param["x"]))/param['kratio']-(param['k1A']*param['kfactor']+(8.0*param["Substrate"]*param['k1A']**2.0)/param['kratio']-(4.0*param['k1A']**2.0*param["x"])/param['kratio'])**2.0))/(6.0*2.0**(2.0/3.0)*param['k1A']**2.0*(-2.0*param['k1A']**3.0*param['kfactor']**3.0-(1024.0*param["Substrate"]**3.0*param['k1A']**6.0)/param['kratio']**3.0+(288.0*param["Substrate"]*param['k1A']**4.0)/param['kratio']**2.0-(96.0*param["Substrate"]**2.0*param['k1A']**5.0*param['kfactor'])/param['kratio']**2.0+(36.0*param['k1A']**3.0*param['kfactor'])/param['kratio']-(12.0*param["Substrate"]*param['k1A']**4.0*param['kfactor']**2.0)/param['kratio']+(1536.0*param["Substrate"]**2.0*param['k1A']**6.0*param["x"])/param['kratio']**3.0+(288.0*param['k1A']**4.0*param["x"])/param['kratio']**2.0-(48.0*param["Substrate"]*param['k1A']**5.0*param['kfactor']*param["x"])/param['kratio']**2.0-(12.0*param['k1A']**4.0*param['kfactor']**2.0*param["x"])/param['kratio']-(768.0*param["Substrate"]*param['k1A']**6.0*param["x"]**2.0)/param['kratio']**3.0+(48.0*param['k1A']**5.0*param['kfactor']*param["x"]**2.0)/param['kratio']**2.0+(128.0*param['k1A']**6.0*param["x"]**3.0)/param['kratio']**3.0+sqrt((-2.0*param['k1A']**3.0*param['kfactor']**3.0-(1024.0*param["Substrate"]**3.0*param['k1A']**6.0)/param['kratio']**3.0+(288.0*param["Substrate"]*param['k1A']**4.0)/param['kratio']**2.0-(96.0*param["Substrate"]**2.0*param['k1A']**5.0*param['kfactor'])/param['kratio']**2.0+(36.0*param['k1A']**3.0*param['kfactor'])/param['kratio']-(12.0*param["Substrate"]*param['k1A']**4.0*param['kfactor']**2.0)/param['kratio']+(1536.0*param["Substrate"]**2.0*param['k1A']**6.0*param["x"])/param['kratio']**3.0+(288.0*param['k1A']**4.0*param["x"])/param['kratio']**2.0-(48.0*param["Substrate"]*param['k1A']**5.0*param['kfactor']*param["x"])/param['kratio']**2.0-(12.0*param['k1A']**4.0*param['kfactor']**2.0*param["x"])/param['kratio']-(768.0*param["Substrate"]*param['k1A']**6.0*param["x"]**2.0)/param['kratio']**3.0+(48.0*param['k1A']**5.0*param['kfactor']*param["x"]**2.0)/param['kratio']**2.0+(128.0*param['k1A']**6.0*param["x"]**3.0)/param['kratio']**3.0)**2.0+4.0*((12.0*param['k1A']**2.0*(1.0+param["Substrate"]*param['k1A']*param['kfactor']-param['k1A']*param['kfactor']*param["x"]))/param['kratio']-(param['k1A']*param['kfactor']+(8.0*param["Substrate"]*param['k1A']**2.0)/param['kratio']-(4.0*param['k1A']**2.0*param["x"])/param['kratio'])**2.0)**3.0))**(1.0/3.0))+1.0/(12.0*2.0**(1.0/3.0)*param['k1A']**2.0)*param['kratio']*(-2.0*param['k1A']**3.0*param['kfactor']**3.0-(1024.0*param["Substrate"]**3.0*param['k1A']**6.0)/param['kratio']**3.0+(288.0*param["Substrate"]*param['k1A']**4.0)/param['kratio']**2.0-(96.0*param["Substrate"]**2.0*param['k1A']**5.0*param['kfactor'])/param['kratio']**2.0+(36.0*param['k1A']**3.0*param['kfactor'])/param['kratio']-(12.0*param["Substrate"]*param['k1A']**4.0*param['kfactor']**2.0)/param['kratio']+(1536.0*param["Substrate"]**2.0*param['k1A']**6.0*param["x"])/param['kratio']**3.0+(288.0*param['k1A']**4.0*param["x"])/param['kratio']**2.0-(48.0*param["Substrate"]*param['k1A']**5.0*param['kfactor']*param["x"])/param['kratio']**2.0-(12.0*param['k1A']**4.0*param['kfactor']**2.0*param["x"])/param['kratio']-(768.0*param["Substrate"]*param['k1A']**6.0*param["x"]**2.0)/param['kratio']**3.0+(48.0*param['k1A']**5.0*param['kfactor']*param["x"]**2.0)/param['kratio']**2.0+(128.0*param['k1A']**6.0*param["x"]**3.0)/param['kratio']**3.0+sqrt((-2.0*param['k1A']**3.0*param['kfactor']**3.0-(1024.0*param["Substrate"]**3.0*param['k1A']**6.0)/param['kratio']**3.0+(288.0*param["Substrate"]*param['k1A']**4.0)/param['kratio']**2.0-(96.0*param["Substrate"]**2.0*param['k1A']**5.0*param['kfactor'])/param['kratio']**2.0+(36.0*param['k1A']**3.0*param['kfactor'])/param['kratio']-(12.0*param["Substrate"]*param['k1A']**4.0*param['kfactor']**2.0)/param['kratio']+(1536.0*param["Substrate"]**2.0*param['k1A']**6.0*param["x"])/param['kratio']**3.0+(288.0*param['k1A']**4.0*param["x"])/param['kratio']**2.0-(48.0*param["Substrate"]*param['k1A']**5.0*param['kfactor']*param["x"])/param['kratio']**2.0-(12.0*param['k1A']**4.0*param['kfactor']**2.0*param["x"])/param['kratio']-(768.0*param["Substrate"]*param['k1A']**6.0*param["x"]**2.0)/param['kratio']**3.0+(48.0*param['k1A']**5.0*param['kfactor']*param["x"]**2.0)/param['kratio']**2.0+(128.0*param['k1A']**6.0*param["x"]**3.0)/param['kratio']**3.0)**2.0+4.0*((12.0*param['k1A']**2.0*(1.0+param["Substrate"]*param['k1A']*param['kfactor']-param['k1A']*param['kfactor']*param["x"]))/param['kratio']-(param['k1A']*param['kfactor']+(8.0*param["Substrate"]*param['k1A']**2.0)/param['kratio']-(4.0*param['k1A']**2.0*param["x"])/param['kratio'])**2.0)**3.0))**(1.0/3.0))+1.0/param['kratio']*4.0*param['k1A']**2.0*param['kfactor']*param["x"]*(-((param['kratio']*(param['k1A']*param['kfactor']+(8.0*param["Substrate"]*param['k1A']**2.0)/param['kratio']-(4.0*param['k1A']**2.0*param["x"])/param['kratio']))/(12.0*param['k1A']**2.0))-(param['kratio']*((12.0*param['k1A']**2.0*(1.0+param["Substrate"]*param['k1A']*param['kfactor']-param['k1A']*param['kfactor']*param["x"]))/param['kratio']-(param['k1A']*param['kfactor']+(8.0*param["Substrate"]*param['k1A']**2.0)/param['kratio']-(4.0*param['k1A']**2.0*param["x"])/param['kratio'])**2.0))/(6.0*2.0**(2.0/3.0)*param['k1A']**2.0*(-2.0*param['k1A']**3.0*param['kfactor']**3.0-(1024.0*param["Substrate"]**3.0*param['k1A']**6.0)/param['kratio']**3.0+(288.0*param["Substrate"]*param['k1A']**4.0)/param['kratio']**2.0-(96.0*param["Substrate"]**2.0*param['k1A']**5.0*param['kfactor'])/param['kratio']**2.0+(36.0*param['k1A']**3.0*param['kfactor'])/param['kratio']-(12.0*param["Substrate"]*param['k1A']**4.0*param['kfactor']**2.0)/param['kratio']+(1536.0*param["Substrate"]**2.0*param['k1A']**6.0*param["x"])/param['kratio']**3.0+(288.0*param['k1A']**4.0*param["x"])/param['kratio']**2.0-(48.0*param["Substrate"]*param['k1A']**5.0*param['kfactor']*param["x"])/param['kratio']**2.0-(12.0*param['k1A']**4.0*param['kfactor']**2.0*param["x"])/param['kratio']-(768.0*param["Substrate"]*param['k1A']**6.0*param["x"]**2.0)/param['kratio']**3.0+(48.0*param['k1A']**5.0*param['kfactor']*param["x"]**2.0)/param['kratio']**2.0+(128.0*param['k1A']**6.0*param["x"]**3.0)/param['kratio']**3.0+sqrt((-2.0*param['k1A']**3.0*param['kfactor']**3.0-(1024.0*param["Substrate"]**3.0*param['k1A']**6.0)/param['kratio']**3.0+(288.0*param["Substrate"]*param['k1A']**4.0)/param['kratio']**2.0-(96.0*param["Substrate"]**2.0*param['k1A']**5.0*param['kfactor'])/param['kratio']**2.0+(36.0*param['k1A']**3.0*param['kfactor'])/param['kratio']-(12.0*param["Substrate"]*param['k1A']**4.0*param['kfactor']**2.0)/param['kratio']+(1536.0*param["Substrate"]**2.0*param['k1A']**6.0*param["x"])/param['kratio']**3.0+(288.0*param['k1A']**4.0*param["x"])/param['kratio']**2.0-(48.0*param["Substrate"]*param['k1A']**5.0*param['kfactor']*param["x"])/param['kratio']**2.0-(12.0*param['k1A']**4.0*param['kfactor']**2.0*param["x"])/param['kratio']-(768.0*param["Substrate"]*param['k1A']**6.0*param["x"]**2.0)/param['kratio']**3.0+(48.0*param['k1A']**5.0*param['kfactor']*param["x"]**2.0)/param['kratio']**2.0+(128.0*param['k1A']**6.0*param["x"]**3.0)/param['kratio']**3.0)**2.0+4.0*((12.0*param['k1A']**2.0*(1.0+param["Substrate"]*param['k1A']*param['kfactor']-param['k1A']*param['kfactor']*param["x"]))/param['kratio']-(param['k1A']*param['kfactor']+(8.0*param["Substrate"]*param['k1A']**2.0)/param['kratio']-(4.0*param['k1A']**2.0*param["x"])/param['kratio'])**2.0)**3.0))**(1.0/3.0))+1.0/(12.0*2.0**(1.0/3.0)*param['k1A']**2.0)*param['kratio']*(-2.0*param['k1A']**3.0*param['kfactor']**3.0-(1024.0*param["Substrate"]**3.0*param['k1A']**6.0)/param['kratio']**3.0+(288.0*param["Substrate"]*param['k1A']**4.0)/param['kratio']**2.0-(96.0*param["Substrate"]**2.0*param['k1A']**5.0*param['kfactor'])/param['kratio']**2.0+(36.0*param['k1A']**3.0*param['kfactor'])/param['kratio']-(12.0*param["Substrate"]*param['k1A']**4.0*param['kfactor']**2.0)/param['kratio']+(1536.0*param["Substrate"]**2.0*param['k1A']**6.0*param["x"])/param['kratio']**3.0+(288.0*param['k1A']**4.0*param["x"])/param['kratio']**2.0-(48.0*param["Substrate"]*param['k1A']**5.0*param['kfactor']*param["x"])/param['kratio']**2.0-(12.0*param['k1A']**4.0*param['kfactor']**2.0*param["x"])/param['kratio']-(768.0*param["Substrate"]*param['k1A']**6.0*param["x"]**2.0)/param['kratio']**3.0+(48.0*param['k1A']**5.0*param['kfactor']*param["x"]**2.0)/param['kratio']**2.0+(128.0*param['k1A']**6.0*param["x"]**3.0)/param['kratio']**3.0+sqrt((-2.0*param['k1A']**3.0*param['kfactor']**3.0-(1024.0*param["Substrate"]**3.0*param['k1A']**6.0)/param['kratio']**3.0+(288.0*param["Substrate"]*param['k1A']**4.0)/param['kratio']**2.0-(96.0*param["Substrate"]**2.0*param['k1A']**5.0*param['kfactor'])/param['kratio']**2.0+(36.0*param['k1A']**3.0*param['kfactor'])/param['kratio']-(12.0*param["Substrate"]*param['k1A']**4.0*param['kfactor']**2.0)/param['kratio']+(1536.0*param["Substrate"]**2.0*param['k1A']**6.0*param["x"])/param['kratio']**3.0+(288.0*param['k1A']**4.0*param["x"])/param['kratio']**2.0-(48.0*param["Substrate"]*param['k1A']**5.0*param['kfactor']*param["x"])/param['kratio']**2.0-(12.0*param['k1A']**4.0*param['kfactor']**2.0*param["x"])/param['kratio']-(768.0*param["Substrate"]*param['k1A']**6.0*param["x"]**2.0)/param['kratio']**3.0+(48.0*param['k1A']**5.0*param['kfactor']*param["x"]**2.0)/param['kratio']**2.0+(128.0*param['k1A']**6.0*param["x"]**3.0)/param['kratio']**3.0)**2.0+4.0*((12.0*param['k1A']**2.0*(1.0+param["Substrate"]*param['k1A']*param['kfactor']-param['k1A']*param['kfactor']*param["x"]))/param['kratio']-(param['k1A']*param['kfactor']+(8.0*param["Substrate"]*param['k1A']**2.0)/param['kratio']-(4.0*param['k1A']**2.0*param["x"])/param['kratio'])**2.0)**3.0))**(1.0/3.0))-1.0/param['kratio']*4.0*param['k1A']**2.0*param['kfactor']*(-((param['kratio']*(param['k1A']*param['kfactor']+(8.0*param["Substrate"]*param['k1A']**2.0)/param['kratio']-(4.0*param['k1A']**2.0*param["x"])/param['kratio']))/(12.0*param['k1A']**2.0))-(param['kratio']*((12.0*param['k1A']**2.0*(1.0+param["Substrate"]*param['k1A']*param['kfactor']-param['k1A']*param['kfactor']*param["x"]))/param['kratio']-(param['k1A']*param['kfactor']+(8.0*param["Substrate"]*param['k1A']**2.0)/param['kratio']-(4.0*param['k1A']**2.0*param["x"])/param['kratio'])**2.0))/(6.0*2.0**(2.0/3.0)*param['k1A']**2.0*(-2.0*param['k1A']**3.0*param['kfactor']**3.0-(1024.0*param["Substrate"]**3.0*param['k1A']**6.0)/param['kratio']**3.0+(288.0*param["Substrate"]*param['k1A']**4.0)/param['kratio']**2.0-(96.0*param["Substrate"]**2.0*param['k1A']**5.0*param['kfactor'])/param['kratio']**2.0+(36.0*param['k1A']**3.0*param['kfactor'])/param['kratio']-(12.0*param["Substrate"]*param['k1A']**4.0*param['kfactor']**2.0)/param['kratio']+(1536.0*param["Substrate"]**2.0*param['k1A']**6.0*param["x"])/param['kratio']**3.0+(288.0*param['k1A']**4.0*param["x"])/param['kratio']**2.0-(48.0*param["Substrate"]*param['k1A']**5.0*param['kfactor']*param["x"])/param['kratio']**2.0-(12.0*param['k1A']**4.0*param['kfactor']**2.0*param["x"])/param['kratio']-(768.0*param["Substrate"]*param['k1A']**6.0*param["x"]**2.0)/param['kratio']**3.0+(48.0*param['k1A']**5.0*param['kfactor']*param["x"]**2.0)/param['kratio']**2.0+(128.0*param['k1A']**6.0*param["x"]**3.0)/param['kratio']**3.0+sqrt((-2.0*param['k1A']**3.0*param['kfactor']**3.0-(1024.0*param["Substrate"]**3.0*param['k1A']**6.0)/param['kratio']**3.0+(288.0*param["Substrate"]*param['k1A']**4.0)/param['kratio']**2.0-(96.0*param["Substrate"]**2.0*param['k1A']**5.0*param['kfactor'])/param['kratio']**2.0+(36.0*param['k1A']**3.0*param['kfactor'])/param['kratio']-(12.0*param["Substrate"]*param['k1A']**4.0*param['kfactor']**2.0)/param['kratio']+(1536.0*param["Substrate"]**2.0*param['k1A']**6.0*param["x"])/param['kratio']**3.0+(288.0*param['k1A']**4.0*param["x"])/param['kratio']**2.0-(48.0*param["Substrate"]*param['k1A']**5.0*param['kfactor']*param["x"])/param['kratio']**2.0-(12.0*param['k1A']**4.0*param['kfactor']**2.0*param["x"])/param['kratio']-(768.0*param["Substrate"]*param['k1A']**6.0*param["x"]**2.0)/param['kratio']**3.0+(48.0*param['k1A']**5.0*param['kfactor']*param["x"]**2.0)/param['kratio']**2.0+(128.0*param['k1A']**6.0*param["x"]**3.0)/param['kratio']**3.0)**2.0+4.0*((12.0*param['k1A']**2.0*(1.0+param["Substrate"]*param['k1A']*param['kfactor']-param['k1A']*param['kfactor']*param["x"]))/param['kratio']-(param['k1A']*param['kfactor']+(8.0*param["Substrate"]*param['k1A']**2.0)/param['kratio']-(4.0*param['k1A']**2.0*param["x"])/param['kratio'])**2.0)**3.0))**(1.0/3.0))+1.0/(12.0*2.0**(1.0/3.0)*param['k1A']**2.0)*param['kratio']*(-2.0*param['k1A']**3.0*param['kfactor']**3.0-(1024.0*param["Substrate"]**3.0*param['k1A']**6.0)/param['kratio']**3.0+(288.0*param["Substrate"]*param['k1A']**4.0)/param['kratio']**2.0-(96.0*param["Substrate"]**2.0*param['k1A']**5.0*param['kfactor'])/param['kratio']**2.0+(36.0*param['k1A']**3.0*param['kfactor'])/param['kratio']-(12.0*param["Substrate"]*param['k1A']**4.0*param['kfactor']**2.0)/param['kratio']+(1536.0*param["Substrate"]**2.0*param['k1A']**6.0*param["x"])/param['kratio']**3.0+(288.0*param['k1A']**4.0*param["x"])/param['kratio']**2.0-(48.0*param["Substrate"]*param['k1A']**5.0*param['kfactor']*param["x"])/param['kratio']**2.0-(12.0*param['k1A']**4.0*param['kfactor']**2.0*param["x"])/param['kratio']-(768.0*param["Substrate"]*param['k1A']**6.0*param["x"]**2.0)/param['kratio']**3.0+(48.0*param['k1A']**5.0*param['kfactor']*param["x"]**2.0)/param['kratio']**2.0+(128.0*param['k1A']**6.0*param["x"]**3.0)/param['kratio']**3.0+sqrt((-2.0*param['k1A']**3.0*param['kfactor']**3.0-(1024.0*param["Substrate"]**3.0*param['k1A']**6.0)/param['kratio']**3.0+(288.0*param["Substrate"]*param['k1A']**4.0)/param['kratio']**2.0-(96.0*param["Substrate"]**2.0*param['k1A']**5.0*param['kfactor'])/param['kratio']**2.0+(36.0*param['k1A']**3.0*param['kfactor'])/param['kratio']-(12.0*param["Substrate"]*param['k1A']**4.0*param['kfactor']**2.0)/param['kratio']+(1536.0*param["Substrate"]**2.0*param['k1A']**6.0*param["x"])/param['kratio']**3.0+(288.0*param['k1A']**4.0*param["x"])/param['kratio']**2.0-(48.0*param["Substrate"]*param['k1A']**5.0*param['kfactor']*param["x"])/param['kratio']**2.0-(12.0*param['k1A']**4.0*param['kfactor']**2.0*param["x"])/param['kratio']-(768.0*param["Substrate"]*param['k1A']**6.0*param["x"]**2.0)/param['kratio']**3.0+(48.0*param['k1A']**5.0*param['kfactor']*param["x"]**2.0)/param['kratio']**2.0+(128.0*param['k1A']**6.0*param["x"]**3.0)/param['kratio']**3.0)**2.0+4.0*((12.0*param['k1A']**2.0*(1.0+param["Substrate"]*param['k1A']*param['kfactor']-param['k1A']*param['kfactor']*param["x"]))/param['kratio']-(param['k1A']*param['kfactor']+(8.0*param["Substrate"]*param['k1A']**2.0)/param['kratio']-(4.0*param['k1A']**2.0*param["x"])/param['kratio'])**2.0)**3.0))**(1.0/3.0))**2.0)
    printthis = False
    if printthis:
        print time.time() - start_time
        print "Complex:"
        print "Protein:"
        print P
        print "Substrate:"
        print S
        print "Anisotropy:"
        param["k2A"] = 4.0*param["k1A"]/param["kratio"]
        print (param["r1"] * param['kfactor'] * param['k1A']*P*S + param["r2"] * param['k1A'] * param['k2A']* P*P*S) / param['Substrate']
    """
    print "Norm Conversion to Real:"
    print "Protein:"
    P = ((conj(P)*P)**0.5).real.astype(float)
    print P
    print "Substrate:"
    S = ((conj(S)*S)**0.5).real.astype(float)
    print S
    print "Anisotropy:"
    param["k2A"] = 4.0*param["k1A"]/param["kratio"]
    print (param["r1"] * param['kfactor'] * param['k1A']*P*S + param["r2"] * param['k1A'] * param['k2A']* P*P*S) / param['Substrate']
    """
    P = ((conj(P)*P)**0.5).real.astype(float)
    S = ((conj(S)*S)**0.5).real.astype(float)
    param["k2A"] = 4.0*param["k1A"]/param["kratio"]
    #param["k2A"] = param["k1A"]/param["kratio"]
    print list((2.0*param["r1"] * param['kfactor'] * param['k1A']*P*S + param["r2"] * param['k1A'] * param['k2A']* P*P*S) / param['Substrate'])
    return (2.0*param["r1"] * param['kfactor'] * param['k1A']*P*S + param["r2"] * param['k1A'] * param['k2A']* P*P*S) / param['Substrate']
    
    """
    #print traits
    #ImportOld.calltimes += 1
    #print x
    #print "I have been called: " + str(ImportOld.calltimes) + " times"
    num = len(param["x"])
    
    p = oovar(size=num)
    s = oovar(size=num)
    print param
#    equations = [
#                 (0.0 == param["x"] - p * (ones(num) + param['k1'] * s * (ones(num) + 2.0 * param['k2'] * p)))(tol=1e-12),
#                 (0.0 == param["Substrate"] - s * (ones(num) + param['k1'] * p * (ones(num) + param['k2'] * p)))(tol=1e-12),
#                 ]
    
    param["k2A"] = 4.0*param["k1A"]/param["kratio"]
    # 
    equations = [
                 (param["x"] - p - param["kfactor"] * param['k1A'] * s * p - 2.0 * param['k1A'] * param['k2A'] * p * p * s)(tol=1e-8),
                 (param["Substrate"] - s - param["kfactor"] * param['k1A'] * s * p - param['k1A'] * param['k2A'] * p * p * s)(tol=1e-8),
                 ]
    
    #startpoint = {p:param['x']/2.0, s:param['Substrate']/2.0}
    startpoint = {p:param['x'], s:param['Substrate']}
    #startpoint = {p:zeros(num), s:zeros(num)}
    
    system = SNLE(equations, startpoint, iprint= 10)

    if Data.local_constrained:
        # Slow but works when not close
        constraints = [
                      p > zeros(num), s > zeros(num),
                      p < param['x'], s < param['Substrate'],
                      p > param['x'] - 2*param['Substrate']
                      ]
        system.constraints = constraints
        #solutions = system.solve('interalg')
    
    if snle_style:
        try:
            return [True, param['s'] * (param["Substrate"]-s)/ param['Substrate'], equations, startpoint, constraints]
        except:
            return [True, param['s'] * (param["Substrate"]-s)/ param['Substrate'], equations, startpoint]
    else:
        if Data.local_constrained:
            solutions = system.solve('nssolve')
            
        else:
            # Fast and good if close
            solutions = system.solve('scipy_fsolve')
            
        P, S = p(solutions), s(solutions)
        print "Protein:"
        print P
        print "Substrate:"
        print S
        print "Anisotropy:"
        print (param["r1"] * param['kfactor'] * param['k1A']*P*S + param["r2"] * param['k1A'] * param['k2A']* P*P*S) / param['Substrate']
        try:
            #print param["s"] * (param["Substrate"]-S)/ param['Substrate']
            #return param["s"] * (param["Substrate"]-S)/ param['Substrate']
            return (param["r1"] * param['kfactor'] * param['k1A']*P*S + param["r2"] * param['k1A'] * param['k2A']* P*P*S) / param['Substrate']
        except:
            pass
    """
