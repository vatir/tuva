flor_values = [
        0.102564,
        0.137144,
        0.17026,
        0.201118,
        0.230428,
        0.257586,
        0.283948,
        0.309528,
        0.33276,
        0.355022,
        0.376444,
        0.396238,
        0.414424,
        0.430828,
        0.445334,
        0.45826,
        0.468862,
        0.477456,
        0.483394,
        0.486588,
        0.487222,
        0.485946,
        0.482178,
        0.476434,
        0.468986,
        0.459944,
        0.449492,
        0.438368,
        0.425848,
        0.413048,
        0.40001,
        0.386776,
        0.373378,
        0.359904,
        0.346684,
        0.33371,
        0.320972,
        0.30851,
        0.296276,
        0.284814,
        0.273602,
        0.262478,
        0.251904,
        0.241888,
        0.232218,
        0.222922,
        0.213978,
        0.205232,
        0.19694,
        0.189018,
        0.18131,
        0.174006,
        0.166966,
        0.160096,
        0.153502,
        0.147236,
        0.141298,
        0.135548,
        0.12999,
        0.125028,
        0.120072,
        0.115158,
        0.110462,
        0.105914,
        0.101554,
        0.097438,
        0.09348,
        0.089598,
        0.086088,
        0.0826,
        0.079108,
        0.0759,
        0.072742,
        0.069888,
        0.06712,
        0.06443,
        0.061896,
        0.059412,
        0.056982,
        0.054582,
        0.05233,
        0.05019,
        0.04812,
        0.046208,
        0.044372,
        0.042504,
        0.040722,
        0.03911,
        0.037548,
        0.036074,
        0.034582,
        0.033148,
        0.031744,
        0.030528,
        0.029322,
        0.028086,
        0.026988,
        0.025842,
        0.024726,
        0.023694,
        0.02271,
        0.021754,
        0.020924,
        0.02001,
        0.019244,
        0.018486,
        0.01773,
        0.016952,
        0.0162,
        0.015532,
        0.014912,
        0.01425,
        0.01369,
        0.013122,
        0.012562,
        0.012042,
        0.011598,
        0.011144,
        0.010694,
        0.010232,
        0.009866,
        0.009448,
        0.009052,
        0.00868,
        0.008316,
        0.007948,
        0.00758,
        0.00722,
        0.006926,
        0.00667,
        0.006416,
        0.00615,
        0.005882,
        0.005624,
        0.005366,
        0.005138,
        0.004902,
        0.004682,
        0.0045,
        0.004286,
        0.004092,
        0.003914,
        0.003762,
        0.003646,
        0.003484,
        0.003326,
        0.003184,
        0.003056,
        0.00292,
        0.00279,
        0.002664,
        0.002572,
        0.00247,
        0.002372,
        0.002276,
        0.002192,
        0.0021,
        0.002016,
        0.00194,
        0.001858,
        0.001778,
        0.001692,
        0.001606,
        0.001558,
        0.001502,
        0.001452,
        0.001394,
        0.001336,
        0.001288,
        0.001234,
        0.00118,
        0.00112,
        0.001078,
        0.00103,
        0.000996,
        0.000958,
        0.000932,
        0.000904,
        0.000868,
        0.000832,
        0.0008,
        0.000772,
        0.000732,
        0.000708,
        0.000682,
        0.000656,
        0.000636,
        0.000614,
        0.000592,
        0.000576,
        0.000552,
        0.000534,
        0.000508,
        0.000484,
        0.000462,
        0.000444,
        0.00043,
        0.000412,
        0.000398,
        0.000386,
        0.00037,
        0.000352,
        0.000346,
        0.000324,
        0.00031,
        0.000294,
        0.00029,
        0.00028,
        0.000274,
        0.000268,
        0.000256,
        0.00025,
        0.000242,
        0.00022,
        0.000214,
        0.000206,
        0.000202,
        0.0002,
        0.000196,
        0.000194,
        0.00019,
        0.000184,
        0.000178,
        0.00017,
        0.00017,
        0.000162,
        0.000156,
        0.00015,
        0.000142,
        0.000136,
        0.000134,
        0.00012,
        0.000114,
        0.000112,
        0.000108,
        0.000104,
        0.000102,
        0.0001,
        0.000094,
        0.00009,
        0.000078,
        0.000072,
        0.00007,
        0.000068,
        0.000068,
        0.000064,
        0.000062,
        0.000056,
        0.000054,
        0.000052,
        0.00005,
        0.000046,
        0.000044,
        0.00004,
        0.000038,
        0.000036,
        0.000034,
        0.000032,
        0.00003,
        0.000026,
        0.000026,
        0.000024,
        0.000022,
        0.00002,
        0.000018,
        0.000016,
        0.000016,
        0.000014,
        0.000014,
        0.000014,
        0.000014,
        0.000014,
        0.000014,
        0.000014,
        0.000012,
        0.000012,
        0.000012,
        0.000012,
        0.000012,
        0.000012,
        0.000012,
        0.00001,
        0.00001,
        0.00001,
        0.00001,
        0.00001,
        0.00001,
        0.00001,
        0.00001,
        0.00001,
        0.00001,
        0.00001,
        0.00001,
        0.00001,
        0.00001,
        0.00001,
        0.000008,
        0.000006,
        0.000006,
        0.000006,
        0.000006,
        0.000006,
        0.000006,
        0.000006,
        0.000006,
        0.000006,
        0.000006,
        0.000006,
        0.000006,
        0.000006,
        0.000006,
        0.000006,
        0.000006,
        0.000006,
        0.000006,
        0.000004,
        0.000004,
        0.000004,
        0.000004,
        0.000002,
        0.000002,
        0.000002,
        0.000002,
        0.000002,
        0.000002,
        0.000002,
        ]

from numpy import ones
from numpy import zeros
from math import ceil
#from cmath import *
from numpy.fft import fft
from numpy import complex, exp, pi
from time import time

def Fs(s):
    num = 326
    return F(ones(num) * 0.994700358, ones(num) * 14.8788504, ones(num) * 0.961651086, ones(num) * 2.05542668, ones(num) * 0.5, ones(num) * 32.1455274, s)

def F(A, n, r, kend, kd, kt, s):
    from numpy import ones
    try:
        num = len(A)
    except:
        num = 1
    value = A * (ones(num) + n * r) ** (-1.0) * ((s + kend) ** (-1.0) * (ones(num) + kt * r * (s + kd) ** (-1.0) * (ones(num) - ((kt) * (s + kt + kd) ** (-1.0)) ** n)))
    if num == 1:
        return value[0]
    else:
        return value

def trapezoid(t, omega, sigma, nint):
    try:
        num = len(t)
    except:
        num = 1
        
    sum = zeros(num)
    delta = float(omega) / nint
    wi = zeros()

#   The for-loop below computes the FFT Inversion Algorithm.
#   It is in fact the trapezoidal rule for numerical integration.
    for i in range(1, int(nint + 1)):
        witi = wi * t * 1j

        wf = wi * ones(num) + delta
        wfti = wf * t * 1j

        fi = (exp(witi) * Fs(complex(sigma, wi))).real
        ff = (exp(wfti) * Fs(complex(sigma, wf))).real
        sum = sum + 0.5 * (wf - wi) * (fi + ff)
        wi = wf
        
    return ((sum * exp(sigma * t) / pi).real)

def Fss(s):
    return F(0.994700358, 14.8788504, 0.961651086, 2.05542668, 0.5, 32.1455274, s)


#   Function InvLap(t,omega,sigma,nint) is invoked.
#print InvLap(0.06,20,0.0,2000)
from numpy import exp, ones, power
from scipy.special import gammaincc, gamma, e
def laplacedfunc(A, n, r, kend, kd, kt, t):
    try:
        num = len(t)
    except:
        num = 1
    value = A * (n * r + 1) ** (-1.0) * (exp(-kend * t) - (kt * r * (exp(-kd * t) - exp(-kend * t)) * (kd - kend) ** (-1.0)) - (gamma(n) * (kd - kend)) ** (-1.0) * (r * kt ** (n + 1.0) * (t ** n) * (exp(-kend * t) * ((t * (kd - kend + kt)) ** (-n) * (gamma(n) - gamma(n) * gammaincc(n, (kd - kend + kt) * t))) + exp(-kd * t) * (kt * t) ** (-n) * (gamma(n) * gammaincc(n, kt * t) - gamma(n))))) 
    #value = A*(n*r+1)**(-1.0)*(exp(-kend*t)-(kt*r*(exp(-kd*t)-exp(-kend*t))*(kd-kend)**(-1.0))-(gamma(n)*(kd-kend))**(-1.0)*(r*kt**(n+1.0)*(t**n)*(exp(-kend*t)*((t*(kd-kend+kt))**(-n)*(gamma(n)-gammainc(n,(kd-kend+kt)*t)))+exp(-kd*t)*(kt*t)**(-n)*(gammainc(n,kt*t)-gamma(n)))))
    #value = (A*(power(e,-(kend*t)) - ((power(e,-(kd*t)) - power(e,-(kend*t)))*kt*r)/(kd - kend) - (power(kt,1 + n)*r*power(t,n)*((-gamma(n) + gammainc(n,kt*t))/(power(e,kd*t)*power(kt*t,n))+(gamma(n) - gammainc(n,(kd - kend + kt)*t))/(power(e,kend*t)*power((kd - kend + kt)*t,n))))/((kd - kend)*gamma(n))))/(1 + n*r)
    
    # Fastest
    #value = (A*(kd - kend + kt*r*(1 - power (kt*t, n)/power ((kd - kend + kt)*t, n)) + (kt* r*(power (kt*t, n)*((kd - kend + kt)*t)**-n*gammainc (n, (kd - kend + kt)*t) - power (e, (-kd + kend)*t)*gammainc (n, kt*t)))/gamma (n)))/(power (e, kend*t)*(kd - kend)*(1 + n*r))

    return value


from numpy import arange, sum
t = arange(0.02, 6.54, 0.02)

start_time = time()
exact = laplacedfunc(0.994700358, 14.8788504, 0.961651086, 2.05542668, 0.5, 32.1455274, t)
#print "Res: " + str(exact - flor_values)
#print "Time elapsed: %f" % (time()-start_time)

from talbot import *
from numpy import array
start_time = time()

talbotvalue = []
for timeentry in arange(0.02, 6.54, 0.02):
    value = talbot(Fss, timeentry, 0.0, ntrap=11)
    talbotvalue.append(value)
talbotvalue = array(talbotvalue)
print "Res: " + str(talbotvalue - exact)
print "Time elapsed: %f" % (time() - start_time)

#===============================================================================
# for omega in range(10,100,10):
#    nint= 50*omega
#    sigma=0.0
#    start_time = time()
#    results = trapezoid(t,omega,sigma,nint)
#    #print results
#    print "Omega: %f" % omega
#    print "Time elapsed: %f" % (time()-start_time)
#    print "SSR: %f" % sum((results - flor_values)**2)
#    #print (results - flor_values)**2
#    
#    for entry in range(len(results)):
#        filehandle.write(str(results[entry]) + "\t" + "0.0" + "\t" + str(t[entry]) + "\t" + "0.0" +"\t" + "omega" + str(omega) + "\t" + "15" + "\n")
#    group_num += 1
# for omega in range(200,900,100):
#    nint= 50*omega
#    sigma=0.0
#    start_time = time()
#    results = trapezoid(t,omega,sigma,nint)
#    #print results
#    print "Omega: %f" % omega
#    print "Time elapsed: %f" % (time()-start_time)
#    print "SSR: %f" % sum((results - flor_values)**2)
#    #print (results - flor_values)**2
#    
#    for entry in range(len(results)):
#        filehandle.write(str(results[entry]) + "\t" + "0.0" + "\t" + str(t[entry]) + "\t" + "0.0" +"\t" + "omega" + str(omega) + "\t" + "15" + "\n")
#    group_num += 1
# for omega in range(1000,5000,1000):
#    nint= 50*omega
#    sigma=0.0
#    start_time = time()
#    results = trapezoid(t,omega,sigma,nint)
#    #print results
#    print "Omega: %f" % omega
#    print "Time elapsed: %f" % (time()-start_time)
#    print "SSR: %f" % sum((results - flor_values)**2)
#    #print (results - flor_values)**2
#    
#    for entry in range(len(results)):
#        filehandle.write(str(results[entry]) + "\t" + "0.0" + "\t" + str(t[entry]) + "\t" + "0.0" +"\t" + "omega" + str(omega) + "\t" + "15" + "\n")
#    group_num += 1
#===============================================================================
    
