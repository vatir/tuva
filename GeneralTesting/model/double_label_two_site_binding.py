#from numpy import ones
from collections import OrderedDict

"""
Setup Data Parameters for the Model
"""

data_param = [  "Substrate",
                "Anisotropy",
                "Protein",
                "Run_Name"]

output_param = "Anisotropy"

"""
Set Properties for Constrained Version:
    Can be written for both then changed with the Data.contrained variable.
"""

main_constrained = True     # Main Solver
local_constrained = True   # Model Solver

param = OrderedDict()
param = {
          'r1' :  0.0428340631170242,
          'r2'  : 0.117319273765478,
          #'k2' : 0.0,
          'k1A'  : 1.0,
          'kratio' : 1.0,
          'kfactor'  : 1.0,
          }
param_upper_bounds = OrderedDict()
param_upper_bounds = {
          'r1' :  0.0428340631170242,
          'r2'  : 0.117319273765478,
          #'k2' : 0.0,
          'k1A'  : 50.0,
          'kratio' : 1000.0,
          'kfactor'  : 1.0,
          }
param_lower_bounds = OrderedDict()
param_lower_bounds = {
          'r1' :  0.0428340631170242,
          'r2'  : 0.117319273765478,
          #'k2' : 0.0,
          'k1A'  : 0.0,
          'kratio' : 0.0,
          'kfactor'  : 1.0,
          }

#tolerence = 1e-8
#max_runs = 1e4
tolerence = 1e-16
max_runs = 1e8

"""
Setup Defaults for if parameters should be fit globally or per Run_Name Grouping

First Set to False then change the relevant parameters.
"""

use_individual_params = OrderedDict()
for key in param:
    use_individual_params[key]=False

"""
All Params are Global in this Case

use_individual_params["s"]=True
"""
from numpy.lib.scimath import sqrt
from numpy import conj

def func(param, return_oofunvalue=False):
    P = -((param['kratio']*(param['k1A']*param['kfactor']+(8.0*param["Substrate"]*param['k1A']**2.0)/param['kratio']-(4.0*param['k1A']**2.0*param["Protein"])/param['kratio']))/(12.0*param['k1A']**2.0))-(param['kratio']*((12.0*param['k1A']**2.0*(1.0+param["Substrate"]*param['k1A']*param['kfactor']-param['k1A']*param['kfactor']*param["Protein"]))/param['kratio']-(param['k1A']*param['kfactor']+(8.0*param["Substrate"]*param['k1A']**2.0)/param['kratio']-(4.0*param['k1A']**2.0*param["Protein"])/param['kratio'])**2.0))/(6.0*2.0**(2.0/3.0)*param['k1A']**2.0*(-2.0*param['k1A']**3.0*param['kfactor']**3.0-(1024.0*param["Substrate"]**3.0*param['k1A']**6.0)/param['kratio']**3.0+(288.0*param["Substrate"]*param['k1A']**4.0)/param['kratio']**2.0-(96.0*param["Substrate"]**2.0*param['k1A']**5.0*param['kfactor'])/param['kratio']**2.0+(36.0*param['k1A']**3.0*param['kfactor'])/param['kratio']-(12.0*param["Substrate"]*param['k1A']**4.0*param['kfactor']**2.0)/param['kratio']+(1536.0*param["Substrate"]**2.0*param['k1A']**6.0*param["Protein"])/param['kratio']**3.0+(288.0*param['k1A']**4.0*param["Protein"])/param['kratio']**2.0-(48.0*param["Substrate"]*param['k1A']**5.0*param['kfactor']*param["Protein"])/param['kratio']**2.0-(12.0*param['k1A']**4.0*param['kfactor']**2.0*param["Protein"])/param['kratio']-(768.0*param["Substrate"]*param['k1A']**6.0*param["Protein"]**2.0)/param['kratio']**3.0+(48.0*param['k1A']**5.0*param['kfactor']*param["Protein"]**2.0)/param['kratio']**2.0+(128.0*param['k1A']**6.0*param["Protein"]**3.0)/param['kratio']**3.0+sqrt((-2.0*param['k1A']**3.0*param['kfactor']**3.0-(1024.0*param["Substrate"]**3.0*param['k1A']**6.0)/param['kratio']**3.0+(288.0*param["Substrate"]*param['k1A']**4.0)/param['kratio']**2.0-(96.0*param["Substrate"]**2.0*param['k1A']**5.0*param['kfactor'])/param['kratio']**2.0+(36.0*param['k1A']**3.0*param['kfactor'])/param['kratio']-(12.0*param["Substrate"]*param['k1A']**4.0*param['kfactor']**2.0)/param['kratio']+(1536.0*param["Substrate"]**2.0*param['k1A']**6.0*param["Protein"])/param['kratio']**3.0+(288.0*param['k1A']**4.0*param["Protein"])/param['kratio']**2.0-(48.0*param["Substrate"]*param['k1A']**5.0*param['kfactor']*param["Protein"])/param['kratio']**2.0-(12.0*param['k1A']**4.0*param['kfactor']**2.0*param["Protein"])/param['kratio']-(768.0*param["Substrate"]*param['k1A']**6.0*param["Protein"]**2.0)/param['kratio']**3.0+(48.0*param['k1A']**5.0*param['kfactor']*param["Protein"]**2.0)/param['kratio']**2.0+(128.0*param['k1A']**6.0*param["Protein"]**3.0)/param['kratio']**3.0)**2.0+4.0*((12.0*param['k1A']**2.0*(1.0+param["Substrate"]*param['k1A']*param['kfactor']-param['k1A']*param['kfactor']*param["Protein"]))/param['kratio']-(param['k1A']*param['kfactor']+(8.0*param["Substrate"]*param['k1A']**2.0)/param['kratio']-(4.0*param['k1A']**2.0*param["Protein"])/param['kratio'])**2.0)**3.0))**(1.0/3.0))+(1.0/(12.0*2.0**(1.0/3.0)*param['k1A']**2.0))*param['kratio']*(-2.0*param['k1A']**3.0*param['kfactor']**3.0-(1024.0*param["Substrate"]**3.0*param['k1A']**6.0)/param['kratio']**3.0+(288.0*param["Substrate"]*param['k1A']**4.0)/param['kratio']**2.0-(96.0*param["Substrate"]**2.0*param['k1A']**5.0*param['kfactor'])/param['kratio']**2.0+(36.0*param['k1A']**3.0*param['kfactor'])/param['kratio']-(12.0*param["Substrate"]*param['k1A']**4.0*param['kfactor']**2.0)/param['kratio']+(1536.0*param["Substrate"]**2.0*param['k1A']**6.0*param["Protein"])/param['kratio']**3.0+(288.0*param['k1A']**4.0*param["Protein"])/param['kratio']**2.0-(48.0*param["Substrate"]*param['k1A']**5.0*param['kfactor']*param["Protein"])/param['kratio']**2.0-(12.0*param['k1A']**4.0*param['kfactor']**2.0*param["Protein"])/param['kratio']-(768.0*param["Substrate"]*param['k1A']**6.0*param["Protein"]**2.0)/param['kratio']**3.0+(48.0*param['k1A']**5.0*param['kfactor']*param["Protein"]**2.0)/param['kratio']**2.0+(128.0*param['k1A']**6.0*param["Protein"]**3.0)/param['kratio']**3.0+sqrt((-2.0*param['k1A']**3.0*param['kfactor']**3.0-(1024.0*param["Substrate"]**3.0*param['k1A']**6.0)/param['kratio']**3.0+(288.0*param["Substrate"]*param['k1A']**4.0)/param['kratio']**2.0-(96.0*param["Substrate"]**2.0*param['k1A']**5.0*param['kfactor'])/param['kratio']**2.0+(36.0*param['k1A']**3.0*param['kfactor'])/param['kratio']-(12.0*param["Substrate"]*param['k1A']**4.0*param['kfactor']**2.0)/param['kratio']+(1536.0*param["Substrate"]**2.0*param['k1A']**6.0*param["Protein"])/param['kratio']**3.0+(288.0*param['k1A']**4.0*param["Protein"])/param['kratio']**2.0-(48.0*param["Substrate"]*param['k1A']**5.0*param['kfactor']*param["Protein"])/param['kratio']**2.0-(12.0*param['k1A']**4.0*param['kfactor']**2.0*param["Protein"])/param['kratio']-(768.0*param["Substrate"]*param['k1A']**6.0*param["Protein"]**2.0)/param['kratio']**3.0+(48.0*param['k1A']**5.0*param['kfactor']*param["Protein"]**2.0)/param['kratio']**2.0+(128.0*param['k1A']**6.0*param["Protein"]**3.0)/param['kratio']**3.0)**2.0+4.0*((12.0*param['k1A']**2.0*(1.0+param["Substrate"]*param['k1A']*param['kfactor']-param['k1A']*param['kfactor']*param["Protein"]))/param['kratio']-(param['k1A']*param['kfactor']+(8.0*param["Substrate"]*param['k1A']**2.0)/param['kratio']-(4.0*param['k1A']**2.0*param["Protein"])/param['kratio'])**2.0)**3.0))**(1.0/3.0)
    S = 1.0/(-param['k1A']*param['kfactor']**2.0+(16.0*param['k1A'])/param['kratio'])*(-param["Substrate"]*param['k1A']*param['kfactor']**2.0+(16.0*param["Substrate"]*param['k1A'])/param['kratio']+param['k1A']*param['kfactor']**2.0*param["Protein"]-(8.0*param['k1A']*param["Protein"])/param['kratio']-param['k1A']*param['kfactor']**2.0*(-((param['kratio']*(param['k1A']*param['kfactor']+(8.0*param["Substrate"]*param['k1A']**2.0)/param['kratio']-(4.0*param['k1A']**2.0*param["Protein"])/param['kratio']))/(12.0*param['k1A']**2.0))-(param['kratio']*((12.0*param['k1A']**2.0*(1.0+param["Substrate"]*param['k1A']*param['kfactor']-param['k1A']*param['kfactor']*param["Protein"]))/param['kratio']-(param['k1A']*param['kfactor']+(8.0*param["Substrate"]*param['k1A']**2.0)/param['kratio']-(4.0*param['k1A']**2.0*param["Protein"])/param['kratio'])**2.0))/(6.0*2.0**(2.0/3.0)*param['k1A']**2.0*(-2.0*param['k1A']**3.0*param['kfactor']**3.0-(1024.0*param["Substrate"]**3.0*param['k1A']**6.0)/param['kratio']**3.0+(288.0*param["Substrate"]*param['k1A']**4.0)/param['kratio']**2.0-(96.0*param["Substrate"]**2.0*param['k1A']**5.0*param['kfactor'])/param['kratio']**2.0+(36.0*param['k1A']**3.0*param['kfactor'])/param['kratio']-(12.0*param["Substrate"]*param['k1A']**4.0*param['kfactor']**2.0)/param['kratio']+(1536.0*param["Substrate"]**2.0*param['k1A']**6.0*param["Protein"])/param['kratio']**3.0+(288.0*param['k1A']**4.0*param["Protein"])/param['kratio']**2.0-(48.0*param["Substrate"]*param['k1A']**5.0*param['kfactor']*param["Protein"])/param['kratio']**2.0-(12.0*param['k1A']**4.0*param['kfactor']**2.0*param["Protein"])/param['kratio']-(768.0*param["Substrate"]*param['k1A']**6.0*param["Protein"]**2.0)/param['kratio']**3.0+(48.0*param['k1A']**5.0*param['kfactor']*param["Protein"]**2.0)/param['kratio']**2.0+(128.0*param['k1A']**6.0*param["Protein"]**3.0)/param['kratio']**3.0+sqrt((-2.0*param['k1A']**3.0*param['kfactor']**3.0-(1024.0*param["Substrate"]**3.0*param['k1A']**6.0)/param['kratio']**3.0+(288.0*param["Substrate"]*param['k1A']**4.0)/param['kratio']**2.0-(96.0*param["Substrate"]**2.0*param['k1A']**5.0*param['kfactor'])/param['kratio']**2.0+(36.0*param['k1A']**3.0*param['kfactor'])/param['kratio']-(12.0*param["Substrate"]*param['k1A']**4.0*param['kfactor']**2.0)/param['kratio']+(1536.0*param["Substrate"]**2.0*param['k1A']**6.0*param["Protein"])/param['kratio']**3.0+(288.0*param['k1A']**4.0*param["Protein"])/param['kratio']**2.0-(48.0*param["Substrate"]*param['k1A']**5.0*param['kfactor']*param["Protein"])/param['kratio']**2.0-(12.0*param['k1A']**4.0*param['kfactor']**2.0*param["Protein"])/param['kratio']-(768.0*param["Substrate"]*param['k1A']**6.0*param["Protein"]**2.0)/param['kratio']**3.0+(48.0*param['k1A']**5.0*param['kfactor']*param["Protein"]**2.0)/param['kratio']**2.0+(128.0*param['k1A']**6.0*param["Protein"]**3.0)/param['kratio']**3.0)**2.0+4.0*((12.0*param['k1A']**2.0*(1.0+param["Substrate"]*param['k1A']*param['kfactor']-param['k1A']*param['kfactor']*param["Protein"]))/param['kratio']-(param['k1A']*param['kfactor']+(8.0*param["Substrate"]*param['k1A']**2.0)/param['kratio']-(4.0*param['k1A']**2.0*param["Protein"])/param['kratio'])**2.0)**3.0))**(1.0/3.0))+1.0/(12.0*2.0**(1.0/3.0)*param['k1A']**2.0)*param['kratio']*(-2.0*param['k1A']**3.0*param['kfactor']**3.0-(1024.0*param["Substrate"]**3.0*param['k1A']**6.0)/param['kratio']**3.0+(288.0*param["Substrate"]*param['k1A']**4.0)/param['kratio']**2.0-(96.0*param["Substrate"]**2.0*param['k1A']**5.0*param['kfactor'])/param['kratio']**2.0+(36.0*param['k1A']**3.0*param['kfactor'])/param['kratio']-(12.0*param["Substrate"]*param['k1A']**4.0*param['kfactor']**2.0)/param['kratio']+(1536.0*param["Substrate"]**2.0*param['k1A']**6.0*param["Protein"])/param['kratio']**3.0+(288.0*param['k1A']**4.0*param["Protein"])/param['kratio']**2.0-(48.0*param["Substrate"]*param['k1A']**5.0*param['kfactor']*param["Protein"])/param['kratio']**2.0-(12.0*param['k1A']**4.0*param['kfactor']**2.0*param["Protein"])/param['kratio']-(768.0*param["Substrate"]*param['k1A']**6.0*param["Protein"]**2.0)/param['kratio']**3.0+(48.0*param['k1A']**5.0*param['kfactor']*param["Protein"]**2.0)/param['kratio']**2.0+(128.0*param['k1A']**6.0*param["Protein"]**3.0)/param['kratio']**3.0+sqrt((-2.0*param['k1A']**3.0*param['kfactor']**3.0-(1024.0*param["Substrate"]**3.0*param['k1A']**6.0)/param['kratio']**3.0+(288.0*param["Substrate"]*param['k1A']**4.0)/param['kratio']**2.0-(96.0*param["Substrate"]**2.0*param['k1A']**5.0*param['kfactor'])/param['kratio']**2.0+(36.0*param['k1A']**3.0*param['kfactor'])/param['kratio']-(12.0*param["Substrate"]*param['k1A']**4.0*param['kfactor']**2.0)/param['kratio']+(1536.0*param["Substrate"]**2.0*param['k1A']**6.0*param["Protein"])/param['kratio']**3.0+(288.0*param['k1A']**4.0*param["Protein"])/param['kratio']**2.0-(48.0*param["Substrate"]*param['k1A']**5.0*param['kfactor']*param["Protein"])/param['kratio']**2.0-(12.0*param['k1A']**4.0*param['kfactor']**2.0*param["Protein"])/param['kratio']-(768.0*param["Substrate"]*param['k1A']**6.0*param["Protein"]**2.0)/param['kratio']**3.0+(48.0*param['k1A']**5.0*param['kfactor']*param["Protein"]**2.0)/param['kratio']**2.0+(128.0*param['k1A']**6.0*param["Protein"]**3.0)/param['kratio']**3.0)**2.0+4.0*((12.0*param['k1A']**2.0*(1.0+param["Substrate"]*param['k1A']*param['kfactor']-param['k1A']*param['kfactor']*param["Protein"]))/param['kratio']-(param['k1A']*param['kfactor']+(8.0*param["Substrate"]*param['k1A']**2.0)/param['kratio']-(4.0*param['k1A']**2.0*param["Protein"])/param['kratio'])**2.0)**3.0))**(1.0/3.0))+1.0/param['kratio']*8.0*param['k1A']*(-((param['kratio']*(param['k1A']*param['kfactor']+(8.0*param["Substrate"]*param['k1A']**2.0)/param['kratio']-(4.0*param['k1A']**2.0*param["Protein"])/param['kratio']))/(12.0*param['k1A']**2.0))-(param['kratio']*((12.0*param['k1A']**2.0*(1.0+param["Substrate"]*param['k1A']*param['kfactor']-param['k1A']*param['kfactor']*param["Protein"]))/param['kratio']-(param['k1A']*param['kfactor']+(8.0*param["Substrate"]*param['k1A']**2.0)/param['kratio']-(4.0*param['k1A']**2.0*param["Protein"])/param['kratio'])**2.0))/(6.0*2.0**(2.0/3.0)*param['k1A']**2.0*(-2.0*param['k1A']**3.0*param['kfactor']**3.0-(1024.0*param["Substrate"]**3.0*param['k1A']**6.0)/param['kratio']**3.0+(288.0*param["Substrate"]*param['k1A']**4.0)/param['kratio']**2.0-(96.0*param["Substrate"]**2.0*param['k1A']**5.0*param['kfactor'])/param['kratio']**2.0+(36.0*param['k1A']**3.0*param['kfactor'])/param['kratio']-(12.0*param["Substrate"]*param['k1A']**4.0*param['kfactor']**2.0)/param['kratio']+(1536.0*param["Substrate"]**2.0*param['k1A']**6.0*param["Protein"])/param['kratio']**3.0+(288.0*param['k1A']**4.0*param["Protein"])/param['kratio']**2.0-(48.0*param["Substrate"]*param['k1A']**5.0*param['kfactor']*param["Protein"])/param['kratio']**2.0-(12.0*param['k1A']**4.0*param['kfactor']**2.0*param["Protein"])/param['kratio']-(768.0*param["Substrate"]*param['k1A']**6.0*param["Protein"]**2.0)/param['kratio']**3.0+(48.0*param['k1A']**5.0*param['kfactor']*param["Protein"]**2.0)/param['kratio']**2.0+(128.0*param['k1A']**6.0*param["Protein"]**3.0)/param['kratio']**3.0+sqrt((-2.0*param['k1A']**3.0*param['kfactor']**3.0-(1024.0*param["Substrate"]**3.0*param['k1A']**6.0)/param['kratio']**3.0+(288.0*param["Substrate"]*param['k1A']**4.0)/param['kratio']**2.0-(96.0*param["Substrate"]**2.0*param['k1A']**5.0*param['kfactor'])/param['kratio']**2.0+(36.0*param['k1A']**3.0*param['kfactor'])/param['kratio']-(12.0*param["Substrate"]*param['k1A']**4.0*param['kfactor']**2.0)/param['kratio']+(1536.0*param["Substrate"]**2.0*param['k1A']**6.0*param["Protein"])/param['kratio']**3.0+(288.0*param['k1A']**4.0*param["Protein"])/param['kratio']**2.0-(48.0*param["Substrate"]*param['k1A']**5.0*param['kfactor']*param["Protein"])/param['kratio']**2.0-(12.0*param['k1A']**4.0*param['kfactor']**2.0*param["Protein"])/param['kratio']-(768.0*param["Substrate"]*param['k1A']**6.0*param["Protein"]**2.0)/param['kratio']**3.0+(48.0*param['k1A']**5.0*param['kfactor']*param["Protein"]**2.0)/param['kratio']**2.0+(128.0*param['k1A']**6.0*param["Protein"]**3.0)/param['kratio']**3.0)**2.0+4.0*((12.0*param['k1A']**2.0*(1.0+param["Substrate"]*param['k1A']*param['kfactor']-param['k1A']*param['kfactor']*param["Protein"]))/param['kratio']-(param['k1A']*param['kfactor']+(8.0*param["Substrate"]*param['k1A']**2.0)/param['kratio']-(4.0*param['k1A']**2.0*param["Protein"])/param['kratio'])**2.0)**3.0))**(1.0/3.0))+1.0/(12.0*2.0**(1.0/3.0)*param['k1A']**2.0)*param['kratio']*(-2.0*param['k1A']**3.0*param['kfactor']**3.0-(1024.0*param["Substrate"]**3.0*param['k1A']**6.0)/param['kratio']**3.0+(288.0*param["Substrate"]*param['k1A']**4.0)/param['kratio']**2.0-(96.0*param["Substrate"]**2.0*param['k1A']**5.0*param['kfactor'])/param['kratio']**2.0+(36.0*param['k1A']**3.0*param['kfactor'])/param['kratio']-(12.0*param["Substrate"]*param['k1A']**4.0*param['kfactor']**2.0)/param['kratio']+(1536.0*param["Substrate"]**2.0*param['k1A']**6.0*param["Protein"])/param['kratio']**3.0+(288.0*param['k1A']**4.0*param["Protein"])/param['kratio']**2.0-(48.0*param["Substrate"]*param['k1A']**5.0*param['kfactor']*param["Protein"])/param['kratio']**2.0-(12.0*param['k1A']**4.0*param['kfactor']**2.0*param["Protein"])/param['kratio']-(768.0*param["Substrate"]*param['k1A']**6.0*param["Protein"]**2.0)/param['kratio']**3.0+(48.0*param['k1A']**5.0*param['kfactor']*param["Protein"]**2.0)/param['kratio']**2.0+(128.0*param['k1A']**6.0*param["Protein"]**3.0)/param['kratio']**3.0+sqrt((-2.0*param['k1A']**3.0*param['kfactor']**3.0-(1024.0*param["Substrate"]**3.0*param['k1A']**6.0)/param['kratio']**3.0+(288.0*param["Substrate"]*param['k1A']**4.0)/param['kratio']**2.0-(96.0*param["Substrate"]**2.0*param['k1A']**5.0*param['kfactor'])/param['kratio']**2.0+(36.0*param['k1A']**3.0*param['kfactor'])/param['kratio']-(12.0*param["Substrate"]*param['k1A']**4.0*param['kfactor']**2.0)/param['kratio']+(1536.0*param["Substrate"]**2.0*param['k1A']**6.0*param["Protein"])/param['kratio']**3.0+(288.0*param['k1A']**4.0*param["Protein"])/param['kratio']**2.0-(48.0*param["Substrate"]*param['k1A']**5.0*param['kfactor']*param["Protein"])/param['kratio']**2.0-(12.0*param['k1A']**4.0*param['kfactor']**2.0*param["Protein"])/param['kratio']-(768.0*param["Substrate"]*param['k1A']**6.0*param["Protein"]**2.0)/param['kratio']**3.0+(48.0*param['k1A']**5.0*param['kfactor']*param["Protein"]**2.0)/param['kratio']**2.0+(128.0*param['k1A']**6.0*param["Protein"]**3.0)/param['kratio']**3.0)**2.0+4.0*((12.0*param['k1A']**2.0*(1.0+param["Substrate"]*param['k1A']*param['kfactor']-param['k1A']*param['kfactor']*param["Protein"]))/param['kratio']-(param['k1A']*param['kfactor']+(8.0*param["Substrate"]*param['k1A']**2.0)/param['kratio']-(4.0*param['k1A']**2.0*param["Protein"])/param['kratio'])**2.0)**3.0))**(1.0/3.0))-1.0/param['kratio']*8.0*param["Substrate"]*param['k1A']**2.0*param['kfactor']*(-((param['kratio']*(param['k1A']*param['kfactor']+(8.0*param["Substrate"]*param['k1A']**2.0)/param['kratio']-(4.0*param['k1A']**2.0*param["Protein"])/param['kratio']))/(12.0*param['k1A']**2.0))-(param['kratio']*((12.0*param['k1A']**2.0*(1.0+param["Substrate"]*param['k1A']*param['kfactor']-param['k1A']*param['kfactor']*param["Protein"]))/param['kratio']-(param['k1A']*param['kfactor']+(8.0*param["Substrate"]*param['k1A']**2.0)/param['kratio']-(4.0*param['k1A']**2.0*param["Protein"])/param['kratio'])**2.0))/(6.0*2.0**(2.0/3.0)*param['k1A']**2.0*(-2.0*param['k1A']**3.0*param['kfactor']**3.0-(1024.0*param["Substrate"]**3.0*param['k1A']**6.0)/param['kratio']**3.0+(288.0*param["Substrate"]*param['k1A']**4.0)/param['kratio']**2.0-(96.0*param["Substrate"]**2.0*param['k1A']**5.0*param['kfactor'])/param['kratio']**2.0+(36.0*param['k1A']**3.0*param['kfactor'])/param['kratio']-(12.0*param["Substrate"]*param['k1A']**4.0*param['kfactor']**2.0)/param['kratio']+(1536.0*param["Substrate"]**2.0*param['k1A']**6.0*param["Protein"])/param['kratio']**3.0+(288.0*param['k1A']**4.0*param["Protein"])/param['kratio']**2.0-(48.0*param["Substrate"]*param['k1A']**5.0*param['kfactor']*param["Protein"])/param['kratio']**2.0-(12.0*param['k1A']**4.0*param['kfactor']**2.0*param["Protein"])/param['kratio']-(768.0*param["Substrate"]*param['k1A']**6.0*param["Protein"]**2.0)/param['kratio']**3.0+(48.0*param['k1A']**5.0*param['kfactor']*param["Protein"]**2.0)/param['kratio']**2.0+(128.0*param['k1A']**6.0*param["Protein"]**3.0)/param['kratio']**3.0+sqrt((-2.0*param['k1A']**3.0*param['kfactor']**3.0-(1024.0*param["Substrate"]**3.0*param['k1A']**6.0)/param['kratio']**3.0+(288.0*param["Substrate"]*param['k1A']**4.0)/param['kratio']**2.0-(96.0*param["Substrate"]**2.0*param['k1A']**5.0*param['kfactor'])/param['kratio']**2.0+(36.0*param['k1A']**3.0*param['kfactor'])/param['kratio']-(12.0*param["Substrate"]*param['k1A']**4.0*param['kfactor']**2.0)/param['kratio']+(1536.0*param["Substrate"]**2.0*param['k1A']**6.0*param["Protein"])/param['kratio']**3.0+(288.0*param['k1A']**4.0*param["Protein"])/param['kratio']**2.0-(48.0*param["Substrate"]*param['k1A']**5.0*param['kfactor']*param["Protein"])/param['kratio']**2.0-(12.0*param['k1A']**4.0*param['kfactor']**2.0*param["Protein"])/param['kratio']-(768.0*param["Substrate"]*param['k1A']**6.0*param["Protein"]**2.0)/param['kratio']**3.0+(48.0*param['k1A']**5.0*param['kfactor']*param["Protein"]**2.0)/param['kratio']**2.0+(128.0*param['k1A']**6.0*param["Protein"]**3.0)/param['kratio']**3.0)**2.0+4.0*((12.0*param['k1A']**2.0*(1.0+param["Substrate"]*param['k1A']*param['kfactor']-param['k1A']*param['kfactor']*param["Protein"]))/param['kratio']-(param['k1A']*param['kfactor']+(8.0*param["Substrate"]*param['k1A']**2.0)/param['kratio']-(4.0*param['k1A']**2.0*param["Protein"])/param['kratio'])**2.0)**3.0))**(1.0/3.0))+1.0/(12.0*2.0**(1.0/3.0)*param['k1A']**2.0)*param['kratio']*(-2.0*param['k1A']**3.0*param['kfactor']**3.0-(1024.0*param["Substrate"]**3.0*param['k1A']**6.0)/param['kratio']**3.0+(288.0*param["Substrate"]*param['k1A']**4.0)/param['kratio']**2.0-(96.0*param["Substrate"]**2.0*param['k1A']**5.0*param['kfactor'])/param['kratio']**2.0+(36.0*param['k1A']**3.0*param['kfactor'])/param['kratio']-(12.0*param["Substrate"]*param['k1A']**4.0*param['kfactor']**2.0)/param['kratio']+(1536.0*param["Substrate"]**2.0*param['k1A']**6.0*param["Protein"])/param['kratio']**3.0+(288.0*param['k1A']**4.0*param["Protein"])/param['kratio']**2.0-(48.0*param["Substrate"]*param['k1A']**5.0*param['kfactor']*param["Protein"])/param['kratio']**2.0-(12.0*param['k1A']**4.0*param['kfactor']**2.0*param["Protein"])/param['kratio']-(768.0*param["Substrate"]*param['k1A']**6.0*param["Protein"]**2.0)/param['kratio']**3.0+(48.0*param['k1A']**5.0*param['kfactor']*param["Protein"]**2.0)/param['kratio']**2.0+(128.0*param['k1A']**6.0*param["Protein"]**3.0)/param['kratio']**3.0+sqrt((-2.0*param['k1A']**3.0*param['kfactor']**3.0-(1024.0*param["Substrate"]**3.0*param['k1A']**6.0)/param['kratio']**3.0+(288.0*param["Substrate"]*param['k1A']**4.0)/param['kratio']**2.0-(96.0*param["Substrate"]**2.0*param['k1A']**5.0*param['kfactor'])/param['kratio']**2.0+(36.0*param['k1A']**3.0*param['kfactor'])/param['kratio']-(12.0*param["Substrate"]*param['k1A']**4.0*param['kfactor']**2.0)/param['kratio']+(1536.0*param["Substrate"]**2.0*param['k1A']**6.0*param["Protein"])/param['kratio']**3.0+(288.0*param['k1A']**4.0*param["Protein"])/param['kratio']**2.0-(48.0*param["Substrate"]*param['k1A']**5.0*param['kfactor']*param["Protein"])/param['kratio']**2.0-(12.0*param['k1A']**4.0*param['kfactor']**2.0*param["Protein"])/param['kratio']-(768.0*param["Substrate"]*param['k1A']**6.0*param["Protein"]**2.0)/param['kratio']**3.0+(48.0*param['k1A']**5.0*param['kfactor']*param["Protein"]**2.0)/param['kratio']**2.0+(128.0*param['k1A']**6.0*param["Protein"]**3.0)/param['kratio']**3.0)**2.0+4.0*((12.0*param['k1A']**2.0*(1.0+param["Substrate"]*param['k1A']*param['kfactor']-param['k1A']*param['kfactor']*param["Protein"]))/param['kratio']-(param['k1A']*param['kfactor']+(8.0*param["Substrate"]*param['k1A']**2.0)/param['kratio']-(4.0*param['k1A']**2.0*param["Protein"])/param['kratio'])**2.0)**3.0))**(1.0/3.0))+1.0/param['kratio']*4.0*param['k1A']**2.0*param['kfactor']*param["Protein"]*(-((param['kratio']*(param['k1A']*param['kfactor']+(8.0*param["Substrate"]*param['k1A']**2.0)/param['kratio']-(4.0*param['k1A']**2.0*param["Protein"])/param['kratio']))/(12.0*param['k1A']**2.0))-(param['kratio']*((12.0*param['k1A']**2.0*(1.0+param["Substrate"]*param['k1A']*param['kfactor']-param['k1A']*param['kfactor']*param["Protein"]))/param['kratio']-(param['k1A']*param['kfactor']+(8.0*param["Substrate"]*param['k1A']**2.0)/param['kratio']-(4.0*param['k1A']**2.0*param["Protein"])/param['kratio'])**2.0))/(6.0*2.0**(2.0/3.0)*param['k1A']**2.0*(-2.0*param['k1A']**3.0*param['kfactor']**3.0-(1024.0*param["Substrate"]**3.0*param['k1A']**6.0)/param['kratio']**3.0+(288.0*param["Substrate"]*param['k1A']**4.0)/param['kratio']**2.0-(96.0*param["Substrate"]**2.0*param['k1A']**5.0*param['kfactor'])/param['kratio']**2.0+(36.0*param['k1A']**3.0*param['kfactor'])/param['kratio']-(12.0*param["Substrate"]*param['k1A']**4.0*param['kfactor']**2.0)/param['kratio']+(1536.0*param["Substrate"]**2.0*param['k1A']**6.0*param["Protein"])/param['kratio']**3.0+(288.0*param['k1A']**4.0*param["Protein"])/param['kratio']**2.0-(48.0*param["Substrate"]*param['k1A']**5.0*param['kfactor']*param["Protein"])/param['kratio']**2.0-(12.0*param['k1A']**4.0*param['kfactor']**2.0*param["Protein"])/param['kratio']-(768.0*param["Substrate"]*param['k1A']**6.0*param["Protein"]**2.0)/param['kratio']**3.0+(48.0*param['k1A']**5.0*param['kfactor']*param["Protein"]**2.0)/param['kratio']**2.0+(128.0*param['k1A']**6.0*param["Protein"]**3.0)/param['kratio']**3.0+sqrt((-2.0*param['k1A']**3.0*param['kfactor']**3.0-(1024.0*param["Substrate"]**3.0*param['k1A']**6.0)/param['kratio']**3.0+(288.0*param["Substrate"]*param['k1A']**4.0)/param['kratio']**2.0-(96.0*param["Substrate"]**2.0*param['k1A']**5.0*param['kfactor'])/param['kratio']**2.0+(36.0*param['k1A']**3.0*param['kfactor'])/param['kratio']-(12.0*param["Substrate"]*param['k1A']**4.0*param['kfactor']**2.0)/param['kratio']+(1536.0*param["Substrate"]**2.0*param['k1A']**6.0*param["Protein"])/param['kratio']**3.0+(288.0*param['k1A']**4.0*param["Protein"])/param['kratio']**2.0-(48.0*param["Substrate"]*param['k1A']**5.0*param['kfactor']*param["Protein"])/param['kratio']**2.0-(12.0*param['k1A']**4.0*param['kfactor']**2.0*param["Protein"])/param['kratio']-(768.0*param["Substrate"]*param['k1A']**6.0*param["Protein"]**2.0)/param['kratio']**3.0+(48.0*param['k1A']**5.0*param['kfactor']*param["Protein"]**2.0)/param['kratio']**2.0+(128.0*param['k1A']**6.0*param["Protein"]**3.0)/param['kratio']**3.0)**2.0+4.0*((12.0*param['k1A']**2.0*(1.0+param["Substrate"]*param['k1A']*param['kfactor']-param['k1A']*param['kfactor']*param["Protein"]))/param['kratio']-(param['k1A']*param['kfactor']+(8.0*param["Substrate"]*param['k1A']**2.0)/param['kratio']-(4.0*param['k1A']**2.0*param["Protein"])/param['kratio'])**2.0)**3.0))**(1.0/3.0))+1.0/(12.0*2.0**(1.0/3.0)*param['k1A']**2.0)*param['kratio']*(-2.0*param['k1A']**3.0*param['kfactor']**3.0-(1024.0*param["Substrate"]**3.0*param['k1A']**6.0)/param['kratio']**3.0+(288.0*param["Substrate"]*param['k1A']**4.0)/param['kratio']**2.0-(96.0*param["Substrate"]**2.0*param['k1A']**5.0*param['kfactor'])/param['kratio']**2.0+(36.0*param['k1A']**3.0*param['kfactor'])/param['kratio']-(12.0*param["Substrate"]*param['k1A']**4.0*param['kfactor']**2.0)/param['kratio']+(1536.0*param["Substrate"]**2.0*param['k1A']**6.0*param["Protein"])/param['kratio']**3.0+(288.0*param['k1A']**4.0*param["Protein"])/param['kratio']**2.0-(48.0*param["Substrate"]*param['k1A']**5.0*param['kfactor']*param["Protein"])/param['kratio']**2.0-(12.0*param['k1A']**4.0*param['kfactor']**2.0*param["Protein"])/param['kratio']-(768.0*param["Substrate"]*param['k1A']**6.0*param["Protein"]**2.0)/param['kratio']**3.0+(48.0*param['k1A']**5.0*param['kfactor']*param["Protein"]**2.0)/param['kratio']**2.0+(128.0*param['k1A']**6.0*param["Protein"]**3.0)/param['kratio']**3.0+sqrt((-2.0*param['k1A']**3.0*param['kfactor']**3.0-(1024.0*param["Substrate"]**3.0*param['k1A']**6.0)/param['kratio']**3.0+(288.0*param["Substrate"]*param['k1A']**4.0)/param['kratio']**2.0-(96.0*param["Substrate"]**2.0*param['k1A']**5.0*param['kfactor'])/param['kratio']**2.0+(36.0*param['k1A']**3.0*param['kfactor'])/param['kratio']-(12.0*param["Substrate"]*param['k1A']**4.0*param['kfactor']**2.0)/param['kratio']+(1536.0*param["Substrate"]**2.0*param['k1A']**6.0*param["Protein"])/param['kratio']**3.0+(288.0*param['k1A']**4.0*param["Protein"])/param['kratio']**2.0-(48.0*param["Substrate"]*param['k1A']**5.0*param['kfactor']*param["Protein"])/param['kratio']**2.0-(12.0*param['k1A']**4.0*param['kfactor']**2.0*param["Protein"])/param['kratio']-(768.0*param["Substrate"]*param['k1A']**6.0*param["Protein"]**2.0)/param['kratio']**3.0+(48.0*param['k1A']**5.0*param['kfactor']*param["Protein"]**2.0)/param['kratio']**2.0+(128.0*param['k1A']**6.0*param["Protein"]**3.0)/param['kratio']**3.0)**2.0+4.0*((12.0*param['k1A']**2.0*(1.0+param["Substrate"]*param['k1A']*param['kfactor']-param['k1A']*param['kfactor']*param["Protein"]))/param['kratio']-(param['k1A']*param['kfactor']+(8.0*param["Substrate"]*param['k1A']**2.0)/param['kratio']-(4.0*param['k1A']**2.0*param["Protein"])/param['kratio'])**2.0)**3.0))**(1.0/3.0))-1.0/param['kratio']*4.0*param['k1A']**2.0*param['kfactor']*(-((param['kratio']*(param['k1A']*param['kfactor']+(8.0*param["Substrate"]*param['k1A']**2.0)/param['kratio']-(4.0*param['k1A']**2.0*param["Protein"])/param['kratio']))/(12.0*param['k1A']**2.0))-(param['kratio']*((12.0*param['k1A']**2.0*(1.0+param["Substrate"]*param['k1A']*param['kfactor']-param['k1A']*param['kfactor']*param["Protein"]))/param['kratio']-(param['k1A']*param['kfactor']+(8.0*param["Substrate"]*param['k1A']**2.0)/param['kratio']-(4.0*param['k1A']**2.0*param["Protein"])/param['kratio'])**2.0))/(6.0*2.0**(2.0/3.0)*param['k1A']**2.0*(-2.0*param['k1A']**3.0*param['kfactor']**3.0-(1024.0*param["Substrate"]**3.0*param['k1A']**6.0)/param['kratio']**3.0+(288.0*param["Substrate"]*param['k1A']**4.0)/param['kratio']**2.0-(96.0*param["Substrate"]**2.0*param['k1A']**5.0*param['kfactor'])/param['kratio']**2.0+(36.0*param['k1A']**3.0*param['kfactor'])/param['kratio']-(12.0*param["Substrate"]*param['k1A']**4.0*param['kfactor']**2.0)/param['kratio']+(1536.0*param["Substrate"]**2.0*param['k1A']**6.0*param["Protein"])/param['kratio']**3.0+(288.0*param['k1A']**4.0*param["Protein"])/param['kratio']**2.0-(48.0*param["Substrate"]*param['k1A']**5.0*param['kfactor']*param["Protein"])/param['kratio']**2.0-(12.0*param['k1A']**4.0*param['kfactor']**2.0*param["Protein"])/param['kratio']-(768.0*param["Substrate"]*param['k1A']**6.0*param["Protein"]**2.0)/param['kratio']**3.0+(48.0*param['k1A']**5.0*param['kfactor']*param["Protein"]**2.0)/param['kratio']**2.0+(128.0*param['k1A']**6.0*param["Protein"]**3.0)/param['kratio']**3.0+sqrt((-2.0*param['k1A']**3.0*param['kfactor']**3.0-(1024.0*param["Substrate"]**3.0*param['k1A']**6.0)/param['kratio']**3.0+(288.0*param["Substrate"]*param['k1A']**4.0)/param['kratio']**2.0-(96.0*param["Substrate"]**2.0*param['k1A']**5.0*param['kfactor'])/param['kratio']**2.0+(36.0*param['k1A']**3.0*param['kfactor'])/param['kratio']-(12.0*param["Substrate"]*param['k1A']**4.0*param['kfactor']**2.0)/param['kratio']+(1536.0*param["Substrate"]**2.0*param['k1A']**6.0*param["Protein"])/param['kratio']**3.0+(288.0*param['k1A']**4.0*param["Protein"])/param['kratio']**2.0-(48.0*param["Substrate"]*param['k1A']**5.0*param['kfactor']*param["Protein"])/param['kratio']**2.0-(12.0*param['k1A']**4.0*param['kfactor']**2.0*param["Protein"])/param['kratio']-(768.0*param["Substrate"]*param['k1A']**6.0*param["Protein"]**2.0)/param['kratio']**3.0+(48.0*param['k1A']**5.0*param['kfactor']*param["Protein"]**2.0)/param['kratio']**2.0+(128.0*param['k1A']**6.0*param["Protein"]**3.0)/param['kratio']**3.0)**2.0+4.0*((12.0*param['k1A']**2.0*(1.0+param["Substrate"]*param['k1A']*param['kfactor']-param['k1A']*param['kfactor']*param["Protein"]))/param['kratio']-(param['k1A']*param['kfactor']+(8.0*param["Substrate"]*param['k1A']**2.0)/param['kratio']-(4.0*param['k1A']**2.0*param["Protein"])/param['kratio'])**2.0)**3.0))**(1.0/3.0))+1.0/(12.0*2.0**(1.0/3.0)*param['k1A']**2.0)*param['kratio']*(-2.0*param['k1A']**3.0*param['kfactor']**3.0-(1024.0*param["Substrate"]**3.0*param['k1A']**6.0)/param['kratio']**3.0+(288.0*param["Substrate"]*param['k1A']**4.0)/param['kratio']**2.0-(96.0*param["Substrate"]**2.0*param['k1A']**5.0*param['kfactor'])/param['kratio']**2.0+(36.0*param['k1A']**3.0*param['kfactor'])/param['kratio']-(12.0*param["Substrate"]*param['k1A']**4.0*param['kfactor']**2.0)/param['kratio']+(1536.0*param["Substrate"]**2.0*param['k1A']**6.0*param["Protein"])/param['kratio']**3.0+(288.0*param['k1A']**4.0*param["Protein"])/param['kratio']**2.0-(48.0*param["Substrate"]*param['k1A']**5.0*param['kfactor']*param["Protein"])/param['kratio']**2.0-(12.0*param['k1A']**4.0*param['kfactor']**2.0*param["Protein"])/param['kratio']-(768.0*param["Substrate"]*param['k1A']**6.0*param["Protein"]**2.0)/param['kratio']**3.0+(48.0*param['k1A']**5.0*param['kfactor']*param["Protein"]**2.0)/param['kratio']**2.0+(128.0*param['k1A']**6.0*param["Protein"]**3.0)/param['kratio']**3.0+sqrt((-2.0*param['k1A']**3.0*param['kfactor']**3.0-(1024.0*param["Substrate"]**3.0*param['k1A']**6.0)/param['kratio']**3.0+(288.0*param["Substrate"]*param['k1A']**4.0)/param['kratio']**2.0-(96.0*param["Substrate"]**2.0*param['k1A']**5.0*param['kfactor'])/param['kratio']**2.0+(36.0*param['k1A']**3.0*param['kfactor'])/param['kratio']-(12.0*param["Substrate"]*param['k1A']**4.0*param['kfactor']**2.0)/param['kratio']+(1536.0*param["Substrate"]**2.0*param['k1A']**6.0*param["Protein"])/param['kratio']**3.0+(288.0*param['k1A']**4.0*param["Protein"])/param['kratio']**2.0-(48.0*param["Substrate"]*param['k1A']**5.0*param['kfactor']*param["Protein"])/param['kratio']**2.0-(12.0*param['k1A']**4.0*param['kfactor']**2.0*param["Protein"])/param['kratio']-(768.0*param["Substrate"]*param['k1A']**6.0*param["Protein"]**2.0)/param['kratio']**3.0+(48.0*param['k1A']**5.0*param['kfactor']*param["Protein"]**2.0)/param['kratio']**2.0+(128.0*param['k1A']**6.0*param["Protein"]**3.0)/param['kratio']**3.0)**2.0+4.0*((12.0*param['k1A']**2.0*(1.0+param["Substrate"]*param['k1A']*param['kfactor']-param['k1A']*param['kfactor']*param["Protein"]))/param['kratio']-(param['k1A']*param['kfactor']+(8.0*param["Substrate"]*param['k1A']**2.0)/param['kratio']-(4.0*param['k1A']**2.0*param["Protein"])/param['kratio'])**2.0)**3.0))**(1.0/3.0))**2.0)
    P = ((conj(P)*P)**0.5).real.astype(float)
    S = ((conj(S)*S)**0.5).real.astype(float)
    param["k2A"] = 4.0*param["k1A"]/param["kratio"]
    return (2.0*param["r1"] * param['kfactor'] * param['k1A']*P*S + param["r2"] * param['k1A'] * param['k2A']* P*P*S) / param['Substrate']
